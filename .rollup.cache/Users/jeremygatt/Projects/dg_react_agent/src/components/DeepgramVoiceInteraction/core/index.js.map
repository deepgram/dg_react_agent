{"version":3,"file":"index.js","sourceRoot":"","sources":["index.tsx"],"names":[],"mappings":";AAAA,OAAc,EAAE,UAAU,EAAE,SAAS,EAAE,mBAAmB,EAAE,UAAU,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AAU9F,OAAO,EAAE,qBAAqB,EAAE,MAAM,gDAAgD,CAAC;AACvF,OAAO,EAAE,YAAY,EAAE,MAAM,mCAAmC,CAAC;AACjE,OAAO,EAEL,YAAY,EACZ,YAAY,GACb,MAAM,4CAA4C,CAAC;AACpD,OAAO,EAAE,0BAA0B,EAAE,MAAM,oBAAoB,CAAC;AAEhE,oBAAoB;AACpB,IAAM,SAAS,GAAG,OAAO,MAAM,KAAK,WAAW,CAAC;AAEhD,oBAAoB;AACpB,IAAM,iBAAiB,GAAG;IACxB,gBAAgB,EAAE,kCAAkC;IACpD,QAAQ,EAAE,4CAA4C;CACvD,CAAC;AAEF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAqEG;AACH,SAAS,wBAAwB,CAC/B,KAAoC,EACpC,GAA8C;IAFhD,iBA25BC;IAv5BC,iBAAiB;IACX,IAAA,KAAoB,UAAU,CAAC,YAAY,EAAE,YAAY,CAAC,EAAzD,KAAK,QAAA,EAAE,QAAQ,QAA0C,CAAC;IAEjE,2EAA2E;IAC3E,IAAM,QAAQ,GAAG,MAAM,CAAwB,KAAK,CAAC,CAAC;IAEtD,8DAA8D;IAC9D,IAAM,uBAAuB,GAAG,MAAM,CAA+B,IAAI,CAAC,CAAC;IAC3E,IAAM,eAAe,GAAG,MAAM,CAA+B,IAAI,CAAC,CAAC;IACnE,IAAM,eAAe,GAAG,MAAM,CAAsB,IAAI,CAAC,CAAC;IAE1D,+BAA+B;IAC/B,IAAM,eAAe,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;IAEtC,gEAAgE;IAChE,IAAM,+BAA+B,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;IAEtD,0EAA0E;IAC1E,IAAM,cAAc,GAAG,MAAM,CAAsB,SAAS,CAAC,CAAC;IAC9D,IAAM,iBAAiB,GAAG,MAAM,CAAyB,SAAS,CAAC,CAAC;IACpE,IAAM,gBAAgB,GAAG,MAAM,CAAsB,SAAS,CAAC,CAAC;IAEhE,4CAA4C;IAC5C,IAAI,CAAC,SAAS,EAAE;QACd,OAAO,CAAC,IAAI,CAAC,yDAAyD,CAAC,CAAC;QACxE,OAAO,IAAI,CAAC;KACb;IAGC,IAAA,MAAM,GAiBJ,KAAK,OAjBD,EACN,oBAAoB,GAgBlB,KAAK,qBAhBa,EACpB,YAAY,GAeV,KAAK,aAfK,EACZ,cAAc,GAcZ,KAAK,eAdO,EACd,gBAAgB,GAad,KAAK,iBAbS,EAChB,OAAO,GAYL,KAAK,QAZA,EACP,uBAAuB,GAWrB,KAAK,wBAXgB,EACvB,kBAAkB,GAUhB,KAAK,mBAVW,EAClB,kBAAkB,GAShB,KAAK,mBATW,EAClB,gBAAgB,GAQd,KAAK,iBARS,EAChB,aAAa,GAOX,KAAK,cAPM,EACb,qBAAqB,GAMnB,KAAK,sBANc,EACrB,qBAAqB,GAKnB,KAAK,sBALc,EACrB,qBAAqB,GAInB,KAAK,sBAJc,EACrB,gBAAgB,GAGd,KAAK,iBAHS,EAChB,OAAO,GAEL,KAAK,QAFA,EACP,KACE,KAAK,MADM,EAAb,KAAK,mBAAG,KAAK,KAAA,CACL;IAEV,gBAAgB;IAChB,IAAM,GAAG,GAAG;QAAC,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,yBAAc;;QACzB,IAAI,KAAK,EAAE;YACT,OAAO,CAAC,GAAG,OAAX,OAAO,iBAAK,4BAA4B,GAAK,IAAI,UAAE;SACpD;IACH,CAAC,CAAC;IAEF,8BAA8B;IAC9B,IAAM,QAAQ,GAAG;QAAC,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,yBAAc;;QAC9B,IAAI,KAAK,EAAE;YACT,OAAO,CAAC,GAAG,OAAX,OAAO,iBAAK,qBAAqB,GAAK,IAAI,UAAE;SAC7C;IACH,CAAC,CAAC;IAEF,yCAAyC;IACzC,SAAS,CAAC;QACR,QAAQ,CAAC,OAAO,GAAG,KAAK,CAAC;QAEzB,+EAA+E;QAC/E,IAAI,KAAK,CAAC,UAAU,KAAK,gBAAgB,EAAE;YACzC,IAAM,SAAO,GAAG,UAAU,CAAC;gBACzB,QAAQ,CAAC,6DAA6D,CAAC,CAAC;gBACxE,0DAA0D;gBAC1D,2DAA2D;gBAC3D,IAAI,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,gBAAgB,EAAE;oBACpD,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC,CAAC;iBAC7D;YACH,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,gCAAgC;YAExC,kFAAkF;YAClF,OAAO,cAAM,OAAA,YAAY,CAAC,SAAO,CAAC,EAArB,CAAqB,CAAC;SACpC;IACH,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC;IAEZ,gBAAgB;IAChB,IAAM,WAAW,GAAG,UAAC,KAAwF;QAC3G,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QACrB,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;QACpD,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAG,KAAsB,CAAC,CAAC;IACpC,CAAC,CAAC;IAEF,qDAAqD;IACrD,SAAS,CAAC;;QACR,mBAAmB;QACnB,IAAI,CAAC,MAAM,EAAE;YACX,WAAW,CAAC;gBACV,OAAO,EAAE,eAAe;gBACxB,IAAI,EAAE,iBAAiB;gBACvB,OAAO,EAAE,qBAAqB;aAC/B,CAAC,CAAC;YACH,OAAO;SACR;QAED,gDAAgD;QAChD,IAAM,yBAAyB,GAAG,CAAC,CAAC,oBAAoB,CAAC;QACzD,IAAM,iBAAiB,GAAG,CAAC,CAAC,YAAY,CAAC;QAEzC,IAAI,CAAC,yBAAyB,IAAI,CAAC,iBAAiB,EAAE;YACpD,GAAG,CAAC,uFAAuF,CAAC,CAAC;YAC7F,WAAW,CAAC;gBACV,OAAO,EAAE,eAAe;gBACxB,IAAI,EAAE,uBAAuB;gBAC7B,OAAO,EAAE,8DAA8D;aACxE,CAAC,CAAC;YACH,OAAO;SACR;QAED,0CAA0C;QAC1C,GAAG,CACD,0BACE,yBAAyB,IAAI,iBAAiB;YAC5C,CAAC,CAAC,WAAW;YACb,CAAC,CAAC,yBAAyB;gBAC3B,CAAC,CAAC,yBAAyB;gBAC3B,CAAC,CAAC,iBAAiB,CACrB,CACH,CAAC;QAEF,gFAAgF;QAChF,IAAM,qBAAqB,GAAG,cAAc,IAAI,EAAE,CAAC;QACnD,IAAM,SAAS,GAAG;YAChB,gBAAgB,EACd,qBAAqB,CAAC,gBAAgB,IAAI,iBAAiB,CAAC,gBAAgB;YAC9E,QAAQ,EAAE,qBAAqB,CAAC,QAAQ,IAAI,iBAAiB,CAAC,QAAQ;SACvE,CAAC;QAEF,2CAA2C;QAC3C,IAAI,wBAAwB,GAAe,cAAO,CAAC,CAAC;QACpD,IAAI,gBAAgB,GAAe,cAAO,CAAC,CAAC;QAC5C,IAAI,gBAAgB,GAAe,cAAO,CAAC,CAAC;QAE5C,4CAA4C;QAC5C,IAAI,yBAAyB,EAAE;YAC7B,IAAI,gBAAgB,GAAG,SAAS,CAAC,gBAAgB,CAAC;YAClD,IAAI,wBAAwB,GAA8C,EAAE,CAAC;YAE7E,gCAAgC;YAChC,IAAM,uBAAuB,yBACxB,oBAAoB,KACvB,WAAW,EAAE,oBAAoB,CAAC,WAAW,IAAI,KAAK,EACtD,QAAQ,EAAE,oBAAoB,CAAC,QAAQ,IAAI,UAAU,EACrD,QAAQ,EAAE,oBAAoB,CAAC,QAAQ,IAAI,CAAC,EAC5C,KAAK,EAAE,oBAAoB,CAAC,KAAK,EACjC,OAAO,EAAE,oBAAoB,CAAC,OAAmB,EACjD,QAAQ,EAAE,oBAAoB,CAAC,QAAoB,GACpD,CAAC;YAEF,gDAAgD;YAChD,IAAM,mBAAmB,GACvB,uBAAuB,CAAC,KAAK,KAAK,QAAQ;gBAC1C,KAAK,CAAC,OAAO,CAAC,uBAAuB,CAAC,OAAO,CAAC;gBAC9C,uBAAuB,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;YAE7C,IAAI,mBAAmB,EAAE;gBACvB,GAAG,CAAC,mFAAmF,CAAC,CAAC;gBACzF,yCAAyC;gBACzC,IAAM,GAAG,GAAG,IAAI,GAAG,CAAC,gBAAgB,CAAC,CAAC;gBACtC,IAAM,QAAM,GAAG,IAAI,eAAe,EAAE,CAAC;gBAErC,uDAAuD;gBACvD,KAA2B,UAAuC,EAAvC,KAAA,MAAM,CAAC,OAAO,CAAC,uBAAuB,CAAC,EAAvC,cAAuC,EAAvC,IAAuC,EAAE;oBAAzD,IAAA,WAAY,EAAX,GAAG,QAAA,EAAE,KAAK,QAAA;oBACpB,IAAI,GAAG,KAAK,SAAS,IAAI,KAAK,KAAK,SAAS,EAAE;wBAC5C,QAAM,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;qBACnC;iBACF;gBAED,8CAA8C;gBAC9C,MAAA,uBAAuB,CAAC,OAAO,0CAAE,OAAO,CAAC,UAAC,IAAY;oBACpD,IAAI,IAAI,EAAE;wBACR,2BAA2B;wBAC3B,QAAM,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;qBAChC;gBACH,CAAC,CAAC,CAAC;gBAEH,GAAG,CAAC,MAAM,GAAG,QAAM,CAAC,QAAQ,EAAE,CAAC;gBAC/B,gBAAgB,GAAG,GAAG,CAAC,QAAQ,EAAE,CAAC;gBAClC,GAAG,CAAC,8CAA8C,EAAE,gBAAgB,CAAC,CAAC;gBACtE,sDAAsD;aACvD;iBAAM;gBACL,4FAA4F;gBAC5F,GAAG,CAAC,iFAAiF,CAAC,CAAC;gBAC/E,IAAA,OAAO,GAA+B,uBAAuB,QAAtD,EAAE,QAAQ,GAAqB,uBAAuB,SAA5C,EAAK,WAAW,UAAK,uBAAuB,EAA/D,uBAAqC,CAAF,CAA6B;gBAEtE,0DAA0D;gBAC1D,IAAM,cAAc,GAA8C,EAAE,CAAC;gBACrE,KAA2B,UAA2B,EAA3B,KAAA,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,EAA3B,cAA2B,EAA3B,IAA2B,EAAE;oBAA7C,IAAA,WAAY,EAAX,GAAG,QAAA,EAAE,KAAK,QAAA;oBACpB,IACE,OAAO,KAAK,KAAK,QAAQ;wBACzB,OAAO,KAAK,KAAK,QAAQ;wBACzB,OAAO,KAAK,KAAK,SAAS,EAC1B;wBACA,cAAc,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;qBAC7B;yBAAM;wBACL,GAAG,CAAC,uCAAgC,GAAG,6BAA0B,CAAC,CAAC;qBACpE;iBACF;gBACD,wBAAwB,GAAG,cAAc,CAAC;aAC3C;YAED,yCAAyC;YACzC,uBAAuB,CAAC,OAAO,GAAG,IAAI,qBAAqB,CAAC;gBAC1D,GAAG,EAAE,gBAAgB;gBACrB,MAAM,QAAA;gBACN,OAAO,EAAE,eAAe;gBACxB,WAAW,EAAE,mBAAmB,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,wBAAwB;gBACvE,KAAK,OAAA;aACN,CAAC,CAAC;YAEH,qDAAqD;YACrD,wBAAwB,GAAG,uBAAuB,CAAC,OAAO,CAAC,gBAAgB,CAAC,UAAA,KAAK;gBAC/E,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,IAAI,KAAK,CAAC,KAAK,EAAE;oBACzC,GAAG,CAAC,sBAAsB,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;oBACzC,QAAQ,CAAC;wBACP,IAAI,EAAE,yBAAyB;wBAC/B,OAAO,EAAE,eAAe;wBACxB,KAAK,EAAE,KAAK,CAAC,KAAK;qBACnB,CAAC,CAAC;oBACH,uBAAuB,aAAvB,uBAAuB,uBAAvB,uBAAuB,CAAG,eAAe,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;iBACzD;qBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,EAAE;oBACnC,0BAA0B,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;iBACxC;qBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,IAAI,KAAK,CAAC,KAAK,EAAE;oBAChD,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;iBAC1B;YACH,CAAC,CAAC,CAAC;SACJ;aAAM;YACL,GAAG,CAAC,sDAAsD,CAAC,CAAC;SAC7D;QAED,oCAAoC;QACpC,IAAI,iBAAiB,EAAE;YACrB,iCAAiC;YACjC,eAAe,CAAC,OAAO,GAAG,IAAI,qBAAqB,CAAC;gBAClD,GAAG,EAAE,SAAS,CAAC,QAAQ;gBACvB,MAAM,QAAA;gBACN,OAAO,EAAE,OAAO;gBAChB,KAAK,OAAA;aACN,CAAC,CAAC;YAEH,6CAA6C;YAC7C,gBAAgB,GAAG,eAAe,CAAC,OAAO,CAAC,gBAAgB,CAAC,UAAA,KAAK;gBAC/D,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,IAAI,KAAK,CAAC,KAAK,EAAE;oBACzC,GAAG,CAAC,cAAc,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;oBACjC,QAAQ,CAAC,EAAE,IAAI,EAAE,yBAAyB,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC;oBACpF,uBAAuB,aAAvB,uBAAuB,uBAAvB,uBAAuB,CAAG,OAAO,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;oBAEhD,uDAAuD;oBACvD,IAAI,KAAK,CAAC,KAAK,KAAK,WAAW,EAAE;wBAC/B,iBAAiB,EAAE,CAAC;qBACrB;iBACF;qBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,EAAE;oBACnC,kBAAkB,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;iBAChC;qBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE;oBAClC,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;iBAC9B;qBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,IAAI,KAAK,CAAC,KAAK,EAAE;oBAChD,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;iBAC1B;YACH,CAAC,CAAC,CAAC;SACJ;aAAM;YACL,GAAG,CAAC,8CAA8C,CAAC,CAAC;SACrD;QAED,kDAAkD;QAClD,kEAAkE;QAClE,IAAI,yBAAyB,IAAI,iBAAiB,EAAE;YAClD,qDAAqD;YACrD,IAAM,qBAAqB,GAAG,gBAAgB,CAAC,CAAC,uBAC3C,0BAA0B,GAC1B,gBAAgB,EACnB,CAAC,CAAC,SAAS,CAAC;YAEd,eAAe,CAAC,OAAO,GAAG,IAAI,YAAY,CAAC;gBACzC,KAAK,OAAA;gBACL,gBAAgB,EAAE,qBAAqB;aACxC,EAAE;gBACD,gBAAgB,EAAE,gBAAgB;gBAClC,iBAAiB,EAAE;oBACjB,GAAG,CAAC,8BAA8B,CAAC,CAAC;oBACpC,QAAQ,CAAC,EAAE,IAAI,EAAE,wBAAwB,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC,CAAC;gBAClE,CAAC;gBACD,gBAAgB,EAAE;oBAChB,GAAG,CAAC,8BAA8B,CAAC,CAAC;oBACpC,QAAQ,CAAC,EAAE,IAAI,EAAE,wBAAwB,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC,CAAC;gBACnE,CAAC;gBACD,OAAO,EAAE,WAAW;aACrB,CAAC,CAAC;YAEH,2CAA2C;YAC3C,gBAAgB,GAAG,eAAe,CAAC,OAAO,CAAC,gBAAgB,CAAC,UAAA,KAAK;gBAC/D,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,EAAE;oBAC1B,GAAG,CAAC,qBAAqB,CAAC,CAAC;iBAC5B;qBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,WAAW,EAAE;oBACrC,GAAG,CAAC,kBAAkB,EAAE,KAAK,CAAC,WAAW,CAAC,CAAC;oBAC3C,QAAQ,CAAC,EAAE,IAAI,EAAE,wBAAwB,EAAE,WAAW,EAAE,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;iBAC9E;qBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,EAAE;oBACnC,GAAG,CAAC,gBAAgB,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC;oBACvC,QAAQ,CAAC,EAAE,IAAI,EAAE,uBAAuB,EAAE,SAAS,EAAE,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;iBACzE;qBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,IAAI,KAAK,CAAC,KAAK,EAAE;oBAChD,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;iBAC1B;qBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,MAAM,EAAE;oBAChC,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;iBAC3B;YACH,CAAC,CAAC,CAAC;YAEH,2BAA2B;YAC3B,eAAe,CAAC,OAAO;iBACpB,UAAU,EAAE;iBACZ,IAAI,CAAC;gBACJ,GAAG,CAAC,oDAAoD,CAAC,CAAC;gBAE1D,mEAAmE;gBACnE,sEAAsE;gBACtE,sEAAsE;gBACtE,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;YAC1D,CAAC,CAAC;iBACD,KAAK,CAAC,UAAA,KAAK;gBACV,WAAW,CAAC;oBACV,OAAO,EAAE,eAAe;oBACxB,IAAI,EAAE,kBAAkB;oBACxB,OAAO,EAAE,4BAA4B;oBACrC,OAAO,EAAE,KAAK;iBACf,CAAC,CAAC;gBACH,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;YAC3D,CAAC,CAAC,CAAC;SACN;aAAM;YACL,GAAG,CAAC,kEAAkE,CAAC,CAAC;YACxE,2EAA2E;SAC5E;QAED,WAAW;QACX,OAAO;YACL,wBAAwB,EAAE,CAAC;YAC3B,gBAAgB,EAAE,CAAC;YACnB,gBAAgB,EAAE,CAAC;YAEnB,IAAI,uBAAuB,CAAC,OAAO,EAAE;gBACnC,uBAAuB,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;gBACxC,uBAAuB,CAAC,OAAO,GAAG,IAAI,CAAC;aACxC;YAED,IAAI,eAAe,CAAC,OAAO,EAAE;gBAC3B,eAAe,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;gBAChC,eAAe,CAAC,OAAO,GAAG,IAAI,CAAC;aAChC;YAED,IAAI,eAAe,CAAC,OAAO,EAAE;gBAC3B,eAAe,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;gBAClC,eAAe,CAAC,OAAO,GAAG,IAAI,CAAC;aAChC;YAED,mCAAmC;YACnC,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;YACzD,QAAQ,CAAC,EAAE,IAAI,EAAE,yBAAyB,EAAE,OAAO,EAAE,eAAe,EAAE,KAAK,EAAE,cAAc,EAAE,CAAC,CAAC;YAC/F,QAAQ,CAAC,EAAE,IAAI,EAAE,yBAAyB,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,cAAc,EAAE,CAAC,CAAC;YACvF,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CAAC;YACxD,QAAQ,CAAC,EAAE,IAAI,EAAE,wBAAwB,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC,CAAC;YACjE,QAAQ,CAAC,EAAE,IAAI,EAAE,uBAAuB,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC,CAAC;QAChE,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,MAAM,EAAE,oBAAoB,EAAE,YAAY,EAAE,cAAc,EAAE,gBAAgB,EAAE,KAAK,CAAC,CAAC,CAAC;IAE1F,kEAAkE;IAClE,SAAS,CAAC;QACR,IAAI,OAAO,IAAI,KAAK,CAAC,OAAO,KAAK,cAAc,CAAC,OAAO,EAAE;YACvD,GAAG,CAAC,sCAAsC,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;YAC3D,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;YACvB,cAAc,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;SACxC;IACH,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC;IAE7B,kEAAkE;IAClE,SAAS,CAAC;QACR,IAAI,kBAAkB,IAAI,KAAK,CAAC,UAAU,KAAK,iBAAiB,CAAC,OAAO,EAAE;YACxE,GAAG,CAAC,yCAAyC,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;YACjE,kBAAkB,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YACrC,iBAAiB,CAAC,OAAO,GAAG,KAAK,CAAC,UAAU,CAAC;SAC9C;IACH,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,EAAE,kBAAkB,CAAC,CAAC,CAAC;IAE3C,qEAAqE;IACrE,SAAS,CAAC;QACR,IAAI,qBAAqB,IAAI,KAAK,CAAC,SAAS,KAAK,gBAAgB,CAAC,OAAO,EAAE;YACzE,GAAG,CAAC,wCAAwC,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC;YAC/D,qBAAqB,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;YACvC,gBAAgB,CAAC,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC;SAC5C;IACH,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,EAAE,qBAAqB,CAAC,CAAC,CAAC;IAE7C,+EAA+E;IAC/E,IAAM,0BAA0B,GAAG,UAAC,IAAS;QAC3C,4DAA4D;QAC5D,IAAI,CAAC,uBAAuB,CAAC,OAAO,EAAE;YACpC,GAAG,CAAC,0EAA0E,EAAE,IAAI,CAAC,CAAC;YACtF,OAAO;SACR;QAED,kCAAkC;QAClC,IAAM,oBAAoB,GACxB,eAAe,CAAC,OAAO;YACvB,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,UAAU;gBACzC,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,gBAAgB,CAAC,CAAC;QAEtD,IAAI,IAAI,CAAC,IAAI,KAAK,UAAU,EAAE;YAC5B,IAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC;YAClC,IAAI,oBAAoB,EAAE;gBACxB,QAAQ,CAAC,4BAA4B,EAAE,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;gBACzE,OAAO;aACR;YAED,IAAI,UAAU,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;gBAC1C,eAAe,CAAC,OAAO,GAAG,IAAI,CAAC;gBAC/B,qBAAqB,aAArB,qBAAqB,uBAArB,qBAAqB,EAAI,CAAC;aAC3B;iBAAM,IAAI,CAAC,UAAU,IAAI,eAAe,CAAC,OAAO,EAAE;gBACjD,eAAe,CAAC,OAAO,GAAG,KAAK,CAAC;gBAChC,qBAAqB,aAArB,qBAAqB,uBAArB,qBAAqB,EAAI,CAAC;aAC3B;YACD,OAAO;SACR;QAED,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,IAAI,IAAI,CAAC,IAAI,KAAK,YAAY,EAAE;YACzD,IAAI,oBAAoB,EAAE;gBACxB,QAAQ,CAAC,6BAA6B,EAAE,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;gBAC1E,OAAO;aACR;YAED,IAAM,UAAU,GAAG,IAAqC,CAAC;YACzD,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAG,UAAU,CAAC,CAAC;YACjC,OAAO;SACR;IACH,CAAC,CAAC;IAEF,oFAAoF;IACpF,IAAM,iBAAiB,GAAG;QACxB,IAAI,CAAC,eAAe,CAAC,OAAO,IAAI,CAAC,YAAY,EAAE;YAC7C,GAAG,CAAC,wFAAwF,CAAC,CAAC;YAC9F,OAAO;SACR;QAED,mDAAmD;QACnD,IAAM,eAAe,GAAG;YACtB,IAAI,EAAE,UAAU;YAChB,KAAK,EAAE;gBACL,KAAK,EAAE;oBACL,QAAQ,EAAE,UAAU;oBACpB,WAAW,EAAE,KAAK;iBACnB;gBACD,MAAM,EAAE;oBACN,QAAQ,EAAE,UAAU;oBACpB,WAAW,EAAE,KAAK;iBACnB;aACF;YACD,KAAK,EAAE;gBACL,QAAQ,EAAE,YAAY,CAAC,QAAQ,IAAI,IAAI;gBACvC,MAAM,EAAE;oBACN,QAAQ,EAAE;wBACR,IAAI,EAAE,UAAU;wBAChB,KAAK,EAAE,YAAY,CAAC,WAAW,IAAI,QAAQ;qBAC5C;iBACF;gBACD,KAAK,aACH,QAAQ,EAAE;wBACR,IAAI,EAAE,YAAY,CAAC,iBAAiB,IAAI,SAAS;wBACjD,KAAK,EAAE,YAAY,CAAC,UAAU,IAAI,aAAa;qBAChD,EACD,MAAM,EAAE,YAAY,CAAC,YAAY,IAAI,oCAAoC,IACtE,CAAC,YAAY,CAAC,gBAAgB,IAAI,YAAY,CAAC,WAAW;oBAC3D,CAAC,CAAC;wBACE,QAAQ,EAAE;4BACR,GAAG,EAAE,YAAY,CAAC,gBAAgB;4BAClC,OAAO,EAAE;gCACP,aAAa,EAAE,iBAAU,YAAY,CAAC,WAAW,CAAE;6BACpD;yBACF;qBACF;oBACH,CAAC,CAAC,EAAE,CAAC,CACR;gBACD,KAAK,EAAE;oBACL,QAAQ,EAAE;wBACR,IAAI,EAAE,UAAU;wBAChB,KAAK,EAAE,YAAY,CAAC,KAAK,IAAI,iBAAiB;qBAC/C;iBACF;gBACD,QAAQ,EAAE,YAAY,CAAC,QAAQ;aAChC;SACF,CAAC;QAEF,GAAG,CAAC,yBAAyB,EAAE,eAAe,CAAC,CAAC;QAChD,eAAe,CAAC,OAAO,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC;IACpD,CAAC,CAAC;IAEF,+DAA+D;IAC/D,IAAM,kBAAkB,GAAG,UAAC,IAAS;QACnC,oDAAoD;QACpD,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;YAC5B,GAAG,CAAC,kEAAkE,EAAE,IAAI,CAAC,CAAC;YAC9E,OAAO;SACR;QAED,IAAM,oBAAoB,GACxB,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,UAAU;YAC1C,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,gBAAgB,CAAC;QAEnD,IAAI,IAAI,CAAC,IAAI,KAAK,qBAAqB,EAAE;YACvC,QAAQ,CAAC,sCAAsC,CAAC,CAAC;YACjD,IAAI,oBAAoB,EAAE;gBACxB,QAAQ,CAAC,4CAA4C,EAAE,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;gBACzF,OAAO;aACR;YAED,2CAA2C;YAC3C,GAAG,CAAC,iCAAiC,CAAC,CAAC;YACvC,UAAU,EAAE,CAAC;YACb,qBAAqB,aAArB,qBAAqB,uBAArB,qBAAqB,EAAI,CAAC;YAE1B,IAAI,+BAA+B,CAAC,OAAO,EAAE;gBAC3C,GAAG,CAAC,2DAA2D,CAAC,CAAC;gBACjE,+BAA+B,CAAC,OAAO,GAAG,KAAK,CAAC;aACjD;YAED,QAAQ,CAAC,wEAAwE,CAAC,CAAC;YACnF,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC,CAAC;YAC7D,OAAO;SACR;QAED,IAAI,IAAI,CAAC,IAAI,KAAK,eAAe,EAAE;YACjC,QAAQ,CAAC,4CAA4C,CAAC,CAAC;YACvD,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC,CAAC;YAC5D,OAAO;SACR;QAED,IAAI,IAAI,CAAC,IAAI,KAAK,sBAAsB,EAAE;YACxC,QAAQ,CAAC,4CAA4C,CAAC,CAAC;YACvD,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC,CAAC;YAC5D,OAAO;SACR;QAED,IAAI,IAAI,CAAC,IAAI,KAAK,gBAAgB,EAAE;YAClC,QAAQ,CAAC,8DAA8D,CAAC,CAAC;YACzE,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CAAC;YACxD,OAAO;SACR;QAED,2BAA2B;QAC3B,IAAI,IAAI,CAAC,IAAI,KAAK,kBAAkB,EAAE;YACpC,IAAI,IAAI,CAAC,IAAI,KAAK,WAAW,EAAE;gBAC7B,IAAM,QAAQ,GAAgB;oBAC5B,IAAI,EAAE,KAAK;oBACX,IAAI,EAAE,IAAI,CAAC,OAAO,IAAI,EAAE;oBACxB,QAAQ,EAAE,IAAI;iBACf,CAAC;gBAEF,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAG,QAAQ,CAAC,CAAC;gBAC7B,OAAO;aACR;iBAAM,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,EAAE;gBAC/B,IAAM,QAAQ,GAAG;oBACf,IAAI,EAAE,MAAe;oBACrB,IAAI,EAAE,IAAI,CAAC,OAAO,IAAI,EAAE;oBACxB,QAAQ,EAAE,IAAI;iBACf,CAAC;gBAEF,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAG,QAAQ,CAAC,CAAC;gBAC1B,OAAO;aACR;SACF;QAED,gBAAgB;QAChB,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;YACzB,WAAW,CAAC;gBACV,OAAO,EAAE,OAAO;gBAChB,IAAI,EAAE,IAAI,CAAC,IAAI,IAAI,aAAa;gBAChC,OAAO,EAAE,IAAI,CAAC,WAAW,IAAI,qBAAqB;gBAClD,OAAO,EAAE,IAAI;aACd,CAAC,CAAC;YACH,OAAO;SACR;QAED,kBAAkB;QAClB,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,EAAE;YAC3B,GAAG,CAAC,gBAAgB,EAAE,IAAI,CAAC,WAAW,EAAE,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;YAC5D,OAAO;SACR;IACH,CAAC,CAAC;IAEF,4DAA4D;IAC5D,IAAM,gBAAgB,GAAG,UAAC,IAAiB;QACzC,oDAAoD;QACpD,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;YAC5B,GAAG,CAAC,+DAA+D,CAAC,CAAC;YACrE,OAAO;SACR;QAED,GAAG,CAAC,sDAA+C,IAAI,CAAC,UAAU,WAAQ,CAAC,CAAC;QAE5E,kEAAkE;QAClE,IAAI,+BAA+B,CAAC,OAAO,EAAE;YAC3C,GAAG,CAAC,oEAAoE,CAAC,CAAC;YAC1E,OAAO;SACR;QAED,IAAI,eAAe,CAAC,OAAO,EAAE;YAC3B,GAAG,CAAC,6CAA6C,CAAC,CAAC;YACnD,eAAe,CAAC,OAAO;iBACpB,UAAU,CAAC,IAAI,CAAC;iBAChB,IAAI,CAAC;gBACJ,GAAG,CAAC,+CAA+C,CAAC,CAAC;YACvD,CAAC,CAAC;iBACD,KAAK,CAAC,UAAA,KAAK;gBACV,GAAG,CAAC,uBAAuB,EAAE,KAAK,CAAC,CAAC;YACtC,CAAC,CAAC,CAAC;SACN;aAAM;YACL,GAAG,CAAC,qDAAqD,CAAC,CAAC;SAC5D;IACH,CAAC,CAAC;IAEF,6EAA6E;IAC7E,IAAM,aAAa,GAAG,UAAC,IAAiB;;QACtC,4DAA4D;QAC5D,IAAI,CAAA,MAAA,uBAAuB,CAAC,OAAO,0CAAE,QAAQ,EAAE,MAAK,WAAW,EAAE;YAC/D,uBAAuB,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;SAClD;QAED,wEAAwE;QACxE,IAAI,eAAe,CAAC,OAAO,EAAE;YAC3B,8DAA8D;YAC9D,IAAM,oBAAoB,GACxB,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,UAAU;gBAC1C,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,gBAAgB,CAAC;YAEnD,IAAI,eAAe,CAAC,OAAO,CAAC,QAAQ,EAAE,KAAK,WAAW,IAAI,CAAC,oBAAoB,EAAE;gBAC/E,eAAe,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;aAC1C;iBAAM,IAAI,oBAAoB,EAAE;gBAC/B,QAAQ,CAAC,yCAAyC,EAAE,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;aACvF;SACF;IACH,CAAC,CAAC;IAEF,uBAAuB;IACvB,IAAM,KAAK,GAAG;;;;;;oBAEV,GAAG,CAAC,qBAAqB,CAAC,CAAC;yBAGvB,eAAe,CAAC,OAAO,EAAvB,wBAAuB;;;;oBAEvB,GAAG,CAAC,yCAAyC,CAAC,CAAC;oBAC/C,qBAAM,eAAe,CAAC,OAAO,CAAC,UAAU,EAAE,EAAA;;oBAA1C,SAA0C,CAAC;oBAC3C,GAAG,CAAC,0BAA0B,CAAC,CAAC;;;;oBAEhC,+EAA+E;oBAC/E,yDAAyD;oBACzD,GAAG,CAAC,kCAAkC,EAAE,OAAK,CAAC,CAAC;oBAC/C,MAAM,OAAK,CAAC;;yBAKZ,uBAAuB,CAAC,OAAO,EAA/B,wBAA+B;oBACjC,GAAG,CAAC,uCAAuC,CAAC,CAAC;oBAC7C,qBAAM,uBAAuB,CAAC,OAAO,CAAC,OAAO,EAAE,EAAA;;oBAA/C,SAA+C,CAAC;oBAChD,GAAG,CAAC,mCAAmC,CAAC,CAAC;;;oBAEzC,GAAG,CAAC,2DAA2D,CAAC,CAAC;;;yBAI/D,eAAe,CAAC,OAAO,EAAvB,wBAAuB;oBACzB,GAAG,CAAC,+BAA+B,CAAC,CAAC;oBACrC,qBAAM,eAAe,CAAC,OAAO,CAAC,OAAO,EAAE,EAAA;;oBAAvC,SAAuC,CAAC;oBACxC,GAAG,CAAC,2BAA2B,CAAC,CAAC;;;oBAEjC,GAAG,CAAC,mDAAmD,CAAC,CAAC;;;yBAIvD,eAAe,CAAC,OAAO,EAAvB,yBAAuB;oBACzB,GAAG,CAAC,uBAAuB,CAAC,CAAC;oBAC7B,qBAAM,eAAe,CAAC,OAAO,CAAC,cAAc,EAAE,EAAA;;oBAA9C,SAA8C,CAAC;oBAC/C,GAAG,CAAC,mBAAmB,CAAC,CAAC;;;oBAEzB,GAAG,CAAC,sDAAsD,CAAC,CAAC;oBAC5D,MAAM,IAAI,KAAK,CAAC,2CAA2C,CAAC,CAAC;;oBAG/D,GAAG,CAAC,qCAAqC,CAAC,CAAC;;;;oBAE3C,GAAG,CAAC,4BAA4B,EAAE,OAAK,CAAC,CAAC;oBACzC,WAAW,CAAC;wBACV,OAAO,EAAE,eAAe;wBACxB,IAAI,EAAE,aAAa;wBACnB,OAAO,EAAE,mCAAmC;wBAC5C,OAAO,EAAE,OAAK;qBACf,CAAC,CAAC;oBACH,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;oBACzD,MAAM,OAAK,CAAC;;;;SAEf,CAAC;IAEF,sBAAsB;IACtB,IAAM,IAAI,GAAG;;;;;oBACX,GAAG,CAAC,4BAA4B,CAAC,CAAC;;;;oBAGhC,kFAAkF;oBAClF,IAAI,uBAAuB,CAAC,OAAO,EAAE;wBACnC,GAAG,CAAC,uDAAuD,CAAC,CAAC;wBAC7D,uBAAuB,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC;qBACnD;oBAED,+CAA+C;oBAC/C,IAAI,eAAe,CAAC,OAAO,EAAE;wBAC3B,eAAe,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;qBACzC;oBAED,+DAA+D;oBAC/D,qBAAM,IAAI,OAAO,CAAC,UAAA,OAAO,IAAI,OAAA,UAAU,CAAC,OAAO,EAAE,IAAI,CAAC,EAAzB,CAAyB,CAAC,EAAA;;oBADvD,+DAA+D;oBAC/D,SAAuD,CAAC;oBAExD,iCAAiC;oBACjC,IAAI,uBAAuB,CAAC,OAAO,EAAE;wBACnC,uBAAuB,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;qBACzC;oBAED,IAAI,eAAe,CAAC,OAAO,EAAE;wBAC3B,eAAe,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;qBACjC;oBAED,kCAAkC;oBAClC,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;oBACzD,sBAAO,OAAO,CAAC,OAAO,EAAE,EAAC;;;oBAEzB,GAAG,CAAC,iBAAiB,EAAE,OAAK,CAAC,CAAC;oBAC9B,WAAW,CAAC;wBACV,OAAO,EAAE,eAAe;wBACxB,IAAI,EAAE,YAAY;wBAClB,OAAO,EAAE,oCAAoC;wBAC7C,OAAO,EAAE,OAAK;qBACf,CAAC,CAAC;oBACH,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;oBACzD,sBAAO,OAAO,CAAC,MAAM,CAAC,OAAK,CAAC,EAAC;;;;SAEhC,CAAC;IAEF,0DAA0D;IAC1D,IAAM,uBAAuB,GAAG,UAAC,OAAkC;QACjE,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;YAC5B,GAAG,CAAC,6EAA6E,CAAC,CAAC;YACnF,OAAO;SACR;QAED,GAAG,CAAC,8BAA8B,EAAE,OAAO,CAAC,CAAC;QAE7C,iDAAiD;QACjD,eAAe,CAAC,OAAO,CAAC,QAAQ,CAAC;YAC/B,IAAI,EAAE,cAAc;YACpB,MAAM,EAAE,OAAO,CAAC,YAAY,IAAI,OAAO,CAAC,OAAO,IAAI,EAAE;SACtD,CAAC,CAAC;IACL,CAAC,CAAC;IAEF,2BAA2B;IAC3B,IAAM,UAAU,GAAG;QACjB,GAAG,CAAC,6BAA6B,CAAC,CAAC;QAEnC,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;YAC5B,GAAG,CAAC,uDAAuD,CAAC,CAAC;YAC7D,OAAO;SACR;QAED,IAAI;YACF,GAAG,CAAC,2CAA2C,CAAC,CAAC;YACjD,eAAe,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC;YAE1C,2BAA2B;YAC3B,IAAI,eAAe,CAAC,OAAO,CAAC,cAAc,CAAC,EAAE;gBAC3C,GAAG,CAAC,8CAA8C,CAAC,CAAC;gBACpD,IAAM,GAAG,GAAG,eAAe,CAAC,OAAO,CAAC,cAAc,CAAiB,CAAC;gBACpE,IAAI;oBACF,IAAM,YAAY,GAAG,GAAG,CAAC,YAAY,CAAC,CAAC,EAAE,IAAI,EAAE,GAAG,CAAC,UAAU,CAAC,CAAC;oBAC/D,IAAM,YAAY,GAAG,GAAG,CAAC,kBAAkB,EAAE,CAAC;oBAC9C,YAAY,CAAC,MAAM,GAAG,YAAY,CAAC;oBACnC,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;oBACtC,YAAY,CAAC,KAAK,EAAE,CAAC;iBACtB;gBAAC,OAAO,CAAC,EAAE;oBACV,GAAG,CAAC,kCAAkC,EAAE,CAAC,CAAC,CAAC;iBAC5C;aACF;SACF;QAAC,OAAO,GAAG,EAAE;YACZ,GAAG,CAAC,wBAAwB,EAAE,GAAG,CAAC,CAAC;SACpC;QAED,GAAG,CAAC,gCAAgC,CAAC,CAAC;IACxC,CAAC,CAAC;IAEF,oDAAoD;IACpD,IAAM,cAAc,GAAG;QACrB,GAAG,CAAC,iCAAiC,CAAC,CAAC;QAEvC,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;YAC5B,GAAG,CAAC,yEAAyE,CAAC,CAAC;YAC/E,OAAO;SACR;QAED,UAAU,EAAE,CAAC;QACb,GAAG,CAAC,gCAAgC,CAAC,CAAC;QACtC,QAAQ,CAAC,8DAA8D,CAAC,CAAC;QACzE,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CAAC;QACxD,GAAG,CAAC,oCAAoC,CAAC,CAAC;IAC5C,CAAC,CAAC;IAEF,mDAAmD;IACnD,IAAM,KAAK,GAAG;QACZ,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;YAC5B,GAAG,CAAC,4EAA4E,CAAC,CAAC;YAClF,OAAO;SACR;QAED,QAAQ,CAAC,+CAA+C,CAAC,CAAC;QAC1D,+BAA+B,CAAC,OAAO,GAAG,IAAI,CAAC;QAC/C,UAAU,EAAE,CAAC;QACb,QAAQ,CAAC,iEAAiE,CAAC,CAAC;QAC5E,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,KAAK,EAAE,gBAAgB,EAAE,CAAC,CAAC;IACpE,CAAC,CAAC;IAEF,sDAAsD;IACtD,IAAM,IAAI,GAAG;QACX,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;YAC5B,GAAG,CAAC,oEAAoE,CAAC,CAAC;YAC1E,OAAO;SACR;QAED,IAAI,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,UAAU,EAAE;YAC9C,QAAQ,CACN,qCAA8B,QAAQ,CAAC,OAAO,CAAC,UAAU,qCAAkC,CAC5F,CAAC;YACF,OAAO;SACR;QAED,QAAQ,CAAC,0CAA0C,CAAC,CAAC;QACrD,+BAA+B,CAAC,OAAO,GAAG,KAAK,CAAC;QAChD,QAAQ,CAAC,2DAA2D,CAAC,CAAC;QACtE,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC,CAAC;IAC/D,CAAC,CAAC;IAEF,qEAAqE;IACrE,IAAM,WAAW,GAAG;QAClB,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;YAC5B,GAAG,CAAC,kFAAkF,CAAC,CAAC;YACxF,OAAO;SACR;QAED,QAAQ,CAAC,qDAAqD,EAAE,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAC7F,IAAI,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,UAAU,EAAE;YAC9C,IAAI,EAAE,CAAC;SACR;aAAM,IAAI,QAAQ,CAAC,OAAO,CAAC,UAAU,KAAK,gBAAgB,EAAE;YAC3D,KAAK,EAAE,CAAC;SACT;aAAM;YACL,QAAQ,CAAC,+DAA+D,CAAC,CAAC;SAC3E;QACD,QAAQ,CAAC,2CAA2C,CAAC,CAAC;IACxD,CAAC,CAAC;IAEF,yCAAyC;IACzC,IAAM,kBAAkB,GAAG,UAAC,OAAe;QACzC,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;YAC5B,GAAG,CAAC,wEAAwE,CAAC,CAAC;YAC9E,OAAO;SACR;QAED,GAAG,CAAC,0BAA0B,EAAE,OAAO,CAAC,CAAC;QAEzC,eAAe,CAAC,OAAO,CAAC,QAAQ,CAAC;YAC/B,IAAI,EAAE,oBAAoB;YAC1B,OAAO,EAAE,OAAO;SACjB,CAAC,CAAC;IACL,CAAC,CAAC;IAEF,yBAAyB;IACzB,mBAAmB,CAAC,GAAG,EAAE,cAAM,OAAA,CAAC;QAC9B,KAAK,OAAA;QACL,IAAI,MAAA;QACJ,uBAAuB,yBAAA;QACvB,cAAc,gBAAA;QACd,KAAK,OAAA;QACL,IAAI,MAAA;QACJ,WAAW,aAAA;QACX,kBAAkB,oBAAA;QAClB,cAAc,EAAE;;gBACd,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;oBAC5B,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;iBAClD;gBACD,sBAAO,eAAe,CAAC,OAAO,CAAC,cAAc,EAAE,EAAC;;aACjD;QACD,aAAa,EAAE;YACb,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;gBAC5B,GAAG,CAAC,+BAA+B,CAAC,CAAC;gBACrC,OAAO;aACR;YACD,eAAe,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;QAC1C,CAAC;QACD,0BAA0B,EAAE;;gBAC1B,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;oBAC5B,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;iBAClD;gBACD,sBAAO,eAAe,CAAC,OAAO,CAAC,0BAA0B,EAAE,EAAC;;aAC7D;QACD,kBAAkB,EAAE;YAClB,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE;gBAC5B,OAAO,IAAI,CAAC;aACb;YACD,OAAO,eAAe,CAAC,OAAO,CAAC,kBAAkB,EAAE,CAAC;QACtD,CAAC;KACF,CAAC,EAlC6B,CAkC7B,CAAC,CAAC;IAEJ,sCAAsC;IACtC,OAAO,IAAI,CAAC;AACd,CAAC;AAED,eAAe,UAAU,CAAC,wBAAwB,CAAC,CAAC","sourcesContent":["import React, { forwardRef, useEffect, useImperativeHandle, useReducer, useRef } from 'react';\nimport {\n  AgentState,\n  DeepgramVoiceInteractionHandle,\n  DeepgramVoiceInteractionProps,\n  LLMResponse,\n  TranscriptResponse,\n  UpdateInstructionsPayload,\n} from '../../../types/voice';\nimport { DeepgramError } from '../../../types/common/error';\nimport { VoiceWebSocketManager } from '../../../utils/websocket/VoiceWebSocketManager';\nimport { AudioManager } from '../../../utils/audio/AudioManager';\nimport {\n  VoiceInteractionState,\n  initialState,\n  stateReducer,\n} from '../../../utils/state/VoiceInteractionState';\nimport { DEFAULT_MICROPHONE_OPTIONS } from '../utils/constants';\n\n// Environment check\nconst isBrowser = typeof window !== 'undefined';\n\n// Default endpoints\nconst DEFAULT_ENDPOINTS = {\n  transcriptionUrl: 'wss://api.deepgram.com/v1/listen',\n  agentUrl: 'wss://agent.deepgram.com/v1/agent/converse',\n};\n\n/**\n * DeepgramVoiceInteraction component\n *\n * A headless React component for real-time transcription and/or agent interaction using Deepgram's WebSocket APIs.\n *\n * @component\n *\n * Framework Integration Notes:\n *\n * Next.js:\n * - Import and use the DeepgramWrapper component instead\n * - Add 'use client' directive in your component\n * - Handle environment variables with Next.js config\n * Example:\n * ```tsx\n * 'use client';\n * import { DeepgramWrapper } from 'deepgram-voice-interaction-react';\n *\n * export default function MyComponent() {\n *   return <DeepgramWrapper apiKey={process.env.NEXT_PUBLIC_DEEPGRAM_API_KEY} />;\n * }\n * ```\n *\n * React:\n * - Standard import works out of the box\n * - No special configuration needed\n * Example:\n * ```tsx\n * import { DeepgramVoiceInteraction } from 'deepgram-voice-interaction-react';\n *\n * export default function MyComponent() {\n *   return <DeepgramVoiceInteraction apiKey={process.env.REACT_APP_DEEPGRAM_API_KEY} />;\n * }\n * ```\n *\n * Other Frameworks:\n * - Ensure browser environment is available\n * - Check WebSocket/AudioContext support\n * - Use appropriate environment variable handling\n *\n * IMPORTANT: The component can operate in three distinct modes depending on the options provided:\n *\n * 1. Dual Mode (Transcription + Agent):\n *    - Provide both `transcriptionOptions` and `agentOptions` props\n *    - Uses separate WebSocket connections for transcription and agent\n *    - Enables independent transcription with full customization options\n *    - Can display live transcripts while also having agent conversations\n *\n * 2. Transcription-Only Mode:\n *    - Provide `transcriptionOptions` prop, completely OMIT `agentOptions` prop\n *    - Only connects to transcription service\n *    - Ideal for applications that only need speech-to-text capabilities\n *    - Lighter weight without agent or audio playback functionality\n *\n * 3. Agent-Only Mode:\n *    - Provide `agentOptions` prop, completely OMIT `transcriptionOptions` prop\n *    - Only connects to agent service (agent handles its own transcription internally)\n *    - Ideal for voice assistant applications that don't need separate transcription results\n *    - Agent uses its own internal transcription via the `listenModel` option\n *\n * Error Handling:\n * - Wrap in ErrorBoundary for graceful fallbacks\n * - Check isReady state before operations\n * - Monitor onError callbacks\n *\n * Loading States:\n * - Use onReady callback to handle initialization\n * - Monitor connection states for each service\n * - Provide appropriate UI feedback\n */\nfunction DeepgramVoiceInteraction(\n  props: DeepgramVoiceInteractionProps,\n  ref: React.Ref<DeepgramVoiceInteractionHandle>\n) {\n  // Internal state\n  const [state, dispatch] = useReducer(stateReducer, initialState);\n  \n  // Ref to hold the latest state value, avoiding stale closures in callbacks\n  const stateRef = useRef<VoiceInteractionState>(state);\n\n  // Managers - these may be null if the service is not required\n  const transcriptionManagerRef = useRef<VoiceWebSocketManager | null>(null);\n  const agentManagerRef = useRef<VoiceWebSocketManager | null>(null);\n  const audioManagerRef = useRef<AudioManager | null>(null);\n  \n  // Tracking user speaking state\n  const userSpeakingRef = useRef(false);\n  \n  // Track if we're waiting for user voice after waking from sleep\n  const isWaitingForUserVoiceAfterSleep = useRef(false);\n  \n  // Refs to track previous state values to prevent redundant callback calls\n  const prevIsReadyRef = useRef<boolean | undefined>(undefined);\n  const prevAgentStateRef = useRef<AgentState | undefined>(undefined);\n  const prevIsPlayingRef = useRef<boolean | undefined>(undefined);\n\n  // Early return for non-browser environments\n  if (!isBrowser) {\n    console.warn('DeepgramVoiceInteraction requires a browser environment');\n    return null;\n  }\n\n  const {\n    apiKey,\n    transcriptionOptions,\n    agentOptions,\n    endpointConfig,\n    microphoneConfig,\n    onReady,\n    onConnectionStateChange,\n    onTranscriptUpdate,\n    onAgentStateChange,\n    onAgentUtterance,\n    onUserMessage,\n    onUserStartedSpeaking,\n    onUserStoppedSpeaking,\n    onPlaybackStateChange,\n    onMicrophoneData,\n    onError,\n    debug = false,\n  } = props;\n\n  // Debug logging\n  const log = (...args: any[]) => {\n    if (debug) {\n      console.log('[DeepgramVoiceInteraction]', ...args);\n    }\n  };\n\n  // Targeted sleep/wake logging\n  const sleepLog = (...args: any[]) => {\n    if (debug) {\n      console.log('[SLEEP_CYCLE][CORE]', ...args);\n    }\n  };\n\n  // Update stateRef whenever state changes\n  useEffect(() => {\n    stateRef.current = state;\n\n    // If we just entered the 'entering_sleep' state, schedule the final transition\n    if (state.agentState === 'entering_sleep') {\n      const timerId = setTimeout(() => {\n        sleepLog('Transitioning from entering_sleep to sleeping after timeout');\n        // Ensure we are still in entering_sleep before finalizing\n        // (Could have been woken up or stopped during the timeout)\n        if (stateRef.current.agentState === 'entering_sleep') {\n          dispatch({ type: 'AGENT_STATE_CHANGE', state: 'sleeping' });\n        }\n      }, 50); // 50ms delay - adjust if needed\n\n      // Cleanup timeout if component unmounts or state changes away from entering_sleep\n      return () => clearTimeout(timerId);\n    }\n  }, [state]);\n\n  // Handle errors\n  const handleError = (error: DeepgramError | { service: string; code: string; message: string; details?: any }) => {\n    log('Error:', error);\n    dispatch({ type: 'ERROR', message: error.message });\n    onError?.(error as DeepgramError);\n  };\n\n  // Initialize the component based on provided options\n  useEffect(() => {\n    // Validate API key\n    if (!apiKey) {\n      handleError({\n        service: 'transcription',\n        code: 'invalid_api_key',\n        message: 'API key is required',\n      });\n      return;\n    }\n\n    // Determine which services are being configured\n    const isTranscriptionConfigured = !!transcriptionOptions;\n    const isAgentConfigured = !!agentOptions;\n\n    if (!isTranscriptionConfigured && !isAgentConfigured) {\n      log('No services configured! Either transcriptionOptions or agentOptions must be provided.');\n      handleError({\n        service: 'transcription',\n        code: 'invalid_configuration',\n        message: 'Either transcriptionOptions or agentOptions must be provided',\n      });\n      return;\n    }\n\n    // Log which services are being configured\n    log(\n      `Initializing in ${\n        isTranscriptionConfigured && isAgentConfigured\n          ? 'DUAL MODE'\n          : isTranscriptionConfigured\n          ? 'TRANSCRIPTION-ONLY MODE'\n          : 'AGENT-ONLY MODE'\n      }`\n    );\n\n    // Prepare endpoints, using defaults ONLY if endpointConfig prop is not provided\n    const currentEndpointConfig = endpointConfig || {};\n    const endpoints = {\n      transcriptionUrl:\n        currentEndpointConfig.transcriptionUrl || DEFAULT_ENDPOINTS.transcriptionUrl,\n      agentUrl: currentEndpointConfig.agentUrl || DEFAULT_ENDPOINTS.agentUrl,\n    };\n\n    // --- Event listener cleanup functions ---\n    let transcriptionUnsubscribe: () => void = () => {};\n    let agentUnsubscribe: () => void = () => {};\n    let audioUnsubscribe: () => void = () => {};\n\n    // --- TRANSCRIPTION SETUP (CONDITIONAL) ---\n    if (isTranscriptionConfigured) {\n      let transcriptionUrl = endpoints.transcriptionUrl;\n      let transcriptionQueryParams: Record<string, string | boolean | number> = {};\n\n      // Base transcription parameters\n      const baseTranscriptionParams = {\n        ...transcriptionOptions,\n        sample_rate: transcriptionOptions.sample_rate || 48000,\n        encoding: transcriptionOptions.encoding || 'linear16',\n        channels: transcriptionOptions.channels || 1,\n        model: transcriptionOptions.model,\n        keyterm: transcriptionOptions.keyterm as string[],\n        keywords: transcriptionOptions.keywords as string[],\n      };\n\n      // Check for Nova-3 Keyterm Prompting conditions\n      const useKeytermPrompting =\n        baseTranscriptionParams.model === 'nova-3' &&\n        Array.isArray(baseTranscriptionParams.keyterm) &&\n        baseTranscriptionParams.keyterm.length > 0;\n\n      if (useKeytermPrompting) {\n        log('Nova-3 and keyterms detected. Building transcription URL with keyterm parameters.');\n        // Build URL manually, appending keyterms\n        const url = new URL(transcriptionUrl);\n        const params = new URLSearchParams();\n\n        // Append all other options EXCEPT keyterm array itself\n        for (const [key, value] of Object.entries(baseTranscriptionParams)) {\n          if (key !== 'keyterm' && value !== undefined) {\n            params.append(key, String(value));\n          }\n        }\n\n        // Append each keyterm as a separate parameter\n        baseTranscriptionParams.keyterm?.forEach((term: string) => {\n          if (term) {\n            // Ensure term is not empty\n            params.append('keyterm', term);\n          }\n        });\n\n        url.search = params.toString();\n        transcriptionUrl = url.toString();\n        log('Constructed transcription URL with keyterms:', transcriptionUrl);\n        // queryParams remain empty as they are in the URL now\n      } else {\n        // Standard setup: Build queryParams object, excluding array types like keyterm and keywords\n        log('Not using keyterm prompting. Building queryParams object excluding array types.');\n        const { keyterm, keywords, ...otherParams } = baseTranscriptionParams;\n\n        // Ensure only primitive types are included in queryParams\n        const filteredParams: Record<string, string | number | boolean> = {};\n        for (const [key, value] of Object.entries(otherParams)) {\n          if (\n            typeof value === 'string' ||\n            typeof value === 'number' ||\n            typeof value === 'boolean'\n          ) {\n            filteredParams[key] = value;\n          } else {\n            log(`Skipping non-primitive param ${key} for queryParams object.`);\n          }\n        }\n        transcriptionQueryParams = filteredParams;\n      }\n\n      // Create Transcription WebSocket manager\n      transcriptionManagerRef.current = new VoiceWebSocketManager({\n        url: transcriptionUrl,\n        apiKey,\n        service: 'transcription',\n        queryParams: useKeytermPrompting ? undefined : transcriptionQueryParams,\n        debug,\n      });\n\n      // Set up event listeners for transcription WebSocket\n      transcriptionUnsubscribe = transcriptionManagerRef.current.addEventListener(event => {\n        if (event.type === 'state' && event.state) {\n          log('Transcription state:', event.state);\n          dispatch({\n            type: 'CONNECTION_STATE_CHANGE',\n            service: 'transcription',\n            state: event.state,\n          });\n          onConnectionStateChange?.('transcription', event.state);\n        } else if (event.type === 'message') {\n          handleTranscriptionMessage(event.data);\n        } else if (event.type === 'error' && event.error) {\n          handleError(event.error);\n        }\n      });\n    } else {\n      log('Transcription service not configured, skipping setup');\n    }\n\n    // --- AGENT SETUP (CONDITIONAL) ---\n    if (isAgentConfigured) {\n      // Create Agent WebSocket manager\n      agentManagerRef.current = new VoiceWebSocketManager({\n        url: endpoints.agentUrl,\n        apiKey,\n        service: 'agent',\n        debug,\n      });\n\n      // Set up event listeners for agent WebSocket\n      agentUnsubscribe = agentManagerRef.current.addEventListener(event => {\n        if (event.type === 'state' && event.state) {\n          log('Agent state:', event.state);\n          dispatch({ type: 'CONNECTION_STATE_CHANGE', service: 'agent', state: event.state });\n          onConnectionStateChange?.('agent', event.state);\n\n          // Send settings message when connection is established\n          if (event.state === 'connected') {\n            sendAgentSettings();\n          }\n        } else if (event.type === 'message') {\n          handleAgentMessage(event.data);\n        } else if (event.type === 'binary') {\n          handleAgentAudio(event.data);\n        } else if (event.type === 'error' && event.error) {\n          handleError(event.error);\n        }\n      });\n    } else {\n      log('Agent service not configured, skipping setup');\n    }\n\n    // --- AUDIO SETUP (NEEDED FOR EITHER SERVICE) ---\n    // We need audio for recording (transcription) or playback (agent)\n    if (isTranscriptionConfigured || isAgentConfigured) {\n      // Create audio manager with microphone configuration\n      const finalMicrophoneConfig = microphoneConfig ? {\n        ...DEFAULT_MICROPHONE_OPTIONS,\n        ...microphoneConfig\n      } : undefined;\n\n      audioManagerRef.current = new AudioManager({\n        debug,\n        microphoneConfig: finalMicrophoneConfig,\n      }, {\n        onMicrophoneData: onMicrophoneData,\n        onMicrophoneStart: () => {\n          log('Microphone recording started');\n          dispatch({ type: 'RECORDING_STATE_CHANGE', isRecording: true });\n        },\n        onMicrophoneStop: () => {\n          log('Microphone recording stopped');\n          dispatch({ type: 'RECORDING_STATE_CHANGE', isRecording: false });\n        },\n        onError: handleError,\n      });\n\n      // Set up event listeners for audio manager\n      audioUnsubscribe = audioManagerRef.current.addEventListener(event => {\n        if (event.type === 'ready') {\n          log('Audio manager ready');\n        } else if (event.type === 'recording') {\n          log('Recording state:', event.isRecording);\n          dispatch({ type: 'RECORDING_STATE_CHANGE', isRecording: event.isRecording });\n        } else if (event.type === 'playing') {\n          log('Playing state:', event.isPlaying);\n          dispatch({ type: 'PLAYBACK_STATE_CHANGE', isPlaying: event.isPlaying });\n        } else if (event.type === 'error' && event.error) {\n          handleError(event.error);\n        } else if (event.type === 'data') {\n          sendAudioData(event.data);\n        }\n      });\n\n      // Initialize audio manager\n      audioManagerRef.current\n        .initialize()\n        .then(() => {\n          log('AudioManager initialized successfully in useEffect');\n\n          // Determine if the component is ready based on configured services\n          // For now, we consider it ready as soon as the audio manager is ready\n          // The actual WebSocket connections will be made in the start() method\n          dispatch({ type: 'READY_STATE_CHANGE', isReady: true });\n        })\n        .catch(error => {\n          handleError({\n            service: 'transcription',\n            code: 'audio_init_error',\n            message: 'Failed to initialize audio',\n            details: error,\n          });\n          dispatch({ type: 'READY_STATE_CHANGE', isReady: false });\n        });\n    } else {\n      log('Neither transcription nor agent configured, skipping audio setup');\n      // This should never happen due to the check at the beginning of the effect\n    }\n\n    // Clean up\n    return () => {\n      transcriptionUnsubscribe();\n      agentUnsubscribe();\n      audioUnsubscribe();\n\n      if (transcriptionManagerRef.current) {\n        transcriptionManagerRef.current.close();\n        transcriptionManagerRef.current = null;\n      }\n\n      if (agentManagerRef.current) {\n        agentManagerRef.current.close();\n        agentManagerRef.current = null;\n      }\n\n      if (audioManagerRef.current) {\n        audioManagerRef.current.dispose();\n        audioManagerRef.current = null;\n      }\n\n      // Ensure state is reset on unmount\n      dispatch({ type: 'READY_STATE_CHANGE', isReady: false });\n      dispatch({ type: 'CONNECTION_STATE_CHANGE', service: 'transcription', state: 'disconnected' });\n      dispatch({ type: 'CONNECTION_STATE_CHANGE', service: 'agent', state: 'disconnected' });\n      dispatch({ type: 'AGENT_STATE_CHANGE', state: 'idle' });\n      dispatch({ type: 'RECORDING_STATE_CHANGE', isRecording: false });\n      dispatch({ type: 'PLAYBACK_STATE_CHANGE', isPlaying: false });\n    };\n  }, [apiKey, transcriptionOptions, agentOptions, endpointConfig, microphoneConfig, debug]);\n\n  // Notify ready state changes ONLY when the value actually changes\n  useEffect(() => {\n    if (onReady && state.isReady !== prevIsReadyRef.current) {\n      log('Notifying parent: isReady changed to', state.isReady);\n      onReady(state.isReady);\n      prevIsReadyRef.current = state.isReady;\n    }\n  }, [state.isReady, onReady]);\n\n  // Notify agent state changes ONLY when the value actually changes\n  useEffect(() => {\n    if (onAgentStateChange && state.agentState !== prevAgentStateRef.current) {\n      log('Notifying parent: agentState changed to', state.agentState);\n      onAgentStateChange(state.agentState);\n      prevAgentStateRef.current = state.agentState;\n    }\n  }, [state.agentState, onAgentStateChange]);\n\n  // Notify playback state changes ONLY when the value actually changes\n  useEffect(() => {\n    if (onPlaybackStateChange && state.isPlaying !== prevIsPlayingRef.current) {\n      log('Notifying parent: isPlaying changed to', state.isPlaying);\n      onPlaybackStateChange(state.isPlaying);\n      prevIsPlayingRef.current = state.isPlaying;\n    }\n  }, [state.isPlaying, onPlaybackStateChange]);\n\n  // Handle transcription messages - only relevant if transcription is configured\n  const handleTranscriptionMessage = (data: any) => {\n    // Skip processing if transcription service isn't configured\n    if (!transcriptionManagerRef.current) {\n      log('Received unexpected transcription message but service is not configured:', data);\n      return;\n    }\n\n    // Check if agent is in sleep mode\n    const isSleepingOrEntering =\n      agentManagerRef.current &&\n      (stateRef.current.agentState === 'sleeping' ||\n        stateRef.current.agentState === 'entering_sleep');\n\n    if (data.type === 'VADEvent') {\n      const isSpeaking = data.is_speech;\n      if (isSleepingOrEntering) {\n        sleepLog('Ignoring VAD event (state:', stateRef.current.agentState, ')');\n        return;\n      }\n\n      if (isSpeaking && !userSpeakingRef.current) {\n        userSpeakingRef.current = true;\n        onUserStartedSpeaking?.();\n      } else if (!isSpeaking && userSpeakingRef.current) {\n        userSpeakingRef.current = false;\n        onUserStoppedSpeaking?.();\n      }\n      return;\n    }\n\n    if (data.type === 'Results' || data.type === 'Transcript') {\n      if (isSleepingOrEntering) {\n        sleepLog('Ignoring transcript (state:', stateRef.current.agentState, ')');\n        return;\n      }\n\n      const transcript = data as unknown as TranscriptResponse;\n      onTranscriptUpdate?.(transcript);\n      return;\n    }\n  };\n\n  // Send agent settings after connection is established - only if agent is configured\n  const sendAgentSettings = () => {\n    if (!agentManagerRef.current || !agentOptions) {\n      log('Cannot send agent settings: agent manager not initialized or agentOptions not provided');\n      return;\n    }\n\n    // Build the Settings message based on agentOptions\n    const settingsMessage = {\n      type: 'Settings',\n      audio: {\n        input: {\n          encoding: 'linear16',\n          sample_rate: 48000,\n        },\n        output: {\n          encoding: 'linear16',\n          sample_rate: 48000,\n        },\n      },\n      agent: {\n        language: agentOptions.language || 'en',\n        listen: {\n          provider: {\n            type: 'deepgram',\n            model: agentOptions.listenModel || 'nova-2',\n          },\n        },\n        think: {\n          provider: {\n            type: agentOptions.thinkProviderType || 'open_ai',\n            model: agentOptions.thinkModel || 'gpt-4o-mini',\n          },\n          prompt: agentOptions.instructions || 'You are a helpful voice assistant.',\n          ...(agentOptions.thinkEndpointUrl && agentOptions.thinkApiKey\n            ? {\n                endpoint: {\n                  url: agentOptions.thinkEndpointUrl,\n                  headers: {\n                    authorization: `bearer ${agentOptions.thinkApiKey}`,\n                  },\n                },\n              }\n            : {}),\n        },\n        speak: {\n          provider: {\n            type: 'deepgram',\n            model: agentOptions.voice || 'aura-asteria-en',\n          },\n        },\n        greeting: agentOptions.greeting,\n      },\n    };\n\n    log('Sending agent settings:', settingsMessage);\n    agentManagerRef.current.sendJSON(settingsMessage);\n  };\n\n  // Handle agent messages - only relevant if agent is configured\n  const handleAgentMessage = (data: any) => {\n    // Skip processing if agent service isn't configured\n    if (!agentManagerRef.current) {\n      log('Received unexpected agent message but service is not configured:', data);\n      return;\n    }\n\n    const isSleepingOrEntering =\n      stateRef.current.agentState === 'sleeping' ||\n      stateRef.current.agentState === 'entering_sleep';\n\n    if (data.type === 'UserStartedSpeaking') {\n      sleepLog('UserStartedSpeaking message received');\n      if (isSleepingOrEntering) {\n        sleepLog('Ignoring UserStartedSpeaking event (state:', stateRef.current.agentState, ')');\n        return;\n      }\n\n      // Normal speech handling when not sleeping\n      log('Clearing audio queue (barge-in)');\n      clearAudio();\n      onUserStartedSpeaking?.();\n\n      if (isWaitingForUserVoiceAfterSleep.current) {\n        log('User started speaking after wake - resetting waiting flag');\n        isWaitingForUserVoiceAfterSleep.current = false;\n      }\n\n      sleepLog('Dispatching AGENT_STATE_CHANGE to listening (from UserStartedSpeaking)');\n      dispatch({ type: 'AGENT_STATE_CHANGE', state: 'listening' });\n      return;\n    }\n\n    if (data.type === 'AgentThinking') {\n      sleepLog('Dispatching AGENT_STATE_CHANGE to thinking');\n      dispatch({ type: 'AGENT_STATE_CHANGE', state: 'thinking' });\n      return;\n    }\n\n    if (data.type === 'AgentStartedSpeaking') {\n      sleepLog('Dispatching AGENT_STATE_CHANGE to speaking');\n      dispatch({ type: 'AGENT_STATE_CHANGE', state: 'speaking' });\n      return;\n    }\n\n    if (data.type === 'AgentAudioDone') {\n      sleepLog('Dispatching AGENT_STATE_CHANGE to idle (from AgentAudioDone)');\n      dispatch({ type: 'AGENT_STATE_CHANGE', state: 'idle' });\n      return;\n    }\n\n    // Handle conversation text\n    if (data.type === 'ConversationText') {\n      if (data.role === 'assistant') {\n        const response: LLMResponse = {\n          type: 'llm',\n          text: data.content || '',\n          metadata: data,\n        };\n\n        onAgentUtterance?.(response);\n        return;\n      } else if (data.role === 'user') {\n        const response = {\n          type: 'user' as const,\n          text: data.content || '',\n          metadata: data,\n        };\n\n        onUserMessage?.(response);\n        return;\n      }\n    }\n\n    // Handle errors\n    if (data.type === 'Error') {\n      handleError({\n        service: 'agent',\n        code: data.code || 'agent_error',\n        message: data.description || 'Unknown agent error',\n        details: data,\n      });\n      return;\n    }\n\n    // Handle warnings\n    if (data.type === 'Warning') {\n      log('Agent warning:', data.description, 'Code:', data.code);\n      return;\n    }\n  };\n\n  // Handle agent audio - only relevant if agent is configured\n  const handleAgentAudio = (data: ArrayBuffer) => {\n    // Skip processing if agent service isn't configured\n    if (!agentManagerRef.current) {\n      log('Received unexpected agent audio but service is not configured');\n      return;\n    }\n\n    log(`handleAgentAudio called! Received buffer of ${data.byteLength} bytes`);\n\n    // Skip audio playback if we're waiting for user voice after sleep\n    if (isWaitingForUserVoiceAfterSleep.current) {\n      log('Skipping audio playback because waiting for user voice after sleep');\n      return;\n    }\n\n    if (audioManagerRef.current) {\n      log('Passing buffer to AudioManager.queueAudio()');\n      audioManagerRef.current\n        .queueAudio(data)\n        .then(() => {\n          log('Successfully queued audio buffer for playback');\n        })\n        .catch(error => {\n          log('Error queueing audio:', error);\n        });\n    } else {\n      log('Cannot queue audio: audioManagerRef.current is null');\n    }\n  };\n\n  // Send audio data to WebSockets - conditionally route based on configuration\n  const sendAudioData = (data: ArrayBuffer) => {\n    // Send to transcription service if configured and connected\n    if (transcriptionManagerRef.current?.getState() === 'connected') {\n      transcriptionManagerRef.current.sendBinary(data);\n    }\n\n    // Send to agent service if configured, connected, and not in sleep mode\n    if (agentManagerRef.current) {\n      // Check if sleeping or entering sleep before sending to agent\n      const isSleepingOrEntering =\n        stateRef.current.agentState === 'sleeping' ||\n        stateRef.current.agentState === 'entering_sleep';\n\n      if (agentManagerRef.current.getState() === 'connected' && !isSleepingOrEntering) {\n        agentManagerRef.current.sendBinary(data);\n      } else if (isSleepingOrEntering) {\n        sleepLog('Skipping sendAudioData to agent (state:', stateRef.current.agentState, ')');\n      }\n    }\n  };\n\n  // Start the connection\n  const start = async (): Promise<void> => {\n    try {\n      log('Start method called');\n\n      // Initialize audio if available (should already be initialized from the main useEffect)\n      if (audioManagerRef.current) {\n        try {\n          log('Ensuring AudioManager is initialized...');\n          await audioManagerRef.current.initialize();\n          log('AudioManager initialized');\n        } catch (error) {\n          // The initialize method is idempotent and returns early if already initialized\n          // If we get here, there was an actual error initializing\n          log('Error initializing AudioManager:', error);\n          throw error;\n        }\n      }\n\n      // Connect transcription WebSocket if configured\n      if (transcriptionManagerRef.current) {\n        log('Connecting Transcription WebSocket...');\n        await transcriptionManagerRef.current.connect();\n        log('Transcription WebSocket connected');\n      } else {\n        log('Transcription manager not configured, skipping connection');\n      }\n\n      // Connect agent WebSocket if configured\n      if (agentManagerRef.current) {\n        log('Connecting Agent WebSocket...');\n        await agentManagerRef.current.connect();\n        log('Agent WebSocket connected');\n      } else {\n        log('Agent manager not configured, skipping connection');\n      }\n\n      // Start recording if audio manager is available (needed for either service)\n      if (audioManagerRef.current) {\n        log('Starting recording...');\n        await audioManagerRef.current.startRecording();\n        log('Recording started');\n      } else {\n        log('AudioManager not initialized, cannot start recording');\n        throw new Error('Audio manager not available for recording');\n      }\n\n      log('Start method completed successfully');\n    } catch (error) {\n      log('Error within start method:', error);\n      handleError({\n        service: 'transcription',\n        code: 'start_error',\n        message: 'Failed to start voice interaction',\n        details: error,\n      });\n      dispatch({ type: 'READY_STATE_CHANGE', isReady: false });\n      throw error;\n    }\n  };\n\n  // Stop the connection\n  const stop = async (): Promise<void> => {\n    log('Stopping voice interaction');\n\n    try {\n      // Send CloseStream message to finalize any pending transcriptions (if configured)\n      if (transcriptionManagerRef.current) {\n        log('Sending CloseStream message to finalize transcription');\n        transcriptionManagerRef.current.sendCloseStream();\n      }\n\n      // Stop recording if audio manager is available\n      if (audioManagerRef.current) {\n        audioManagerRef.current.stopRecording();\n      }\n\n      // Add a small delay to allow final transcripts to be processed\n      await new Promise(resolve => setTimeout(resolve, 1000));\n\n      // Close WebSockets if configured\n      if (transcriptionManagerRef.current) {\n        transcriptionManagerRef.current.close();\n      }\n\n      if (agentManagerRef.current) {\n        agentManagerRef.current.close();\n      }\n\n      // Signal not ready after stopping\n      dispatch({ type: 'READY_STATE_CHANGE', isReady: false });\n      return Promise.resolve();\n    } catch (error) {\n      log('Error stopping:', error);\n      handleError({\n        service: 'transcription',\n        code: 'stop_error',\n        message: 'Error while stopping transcription',\n        details: error,\n      });\n      dispatch({ type: 'READY_STATE_CHANGE', isReady: false });\n      return Promise.reject(error);\n    }\n  };\n\n  // Update agent instructions - only if agent is configured\n  const updateAgentInstructions = (payload: UpdateInstructionsPayload): void => {\n    if (!agentManagerRef.current) {\n      log('Cannot update instructions: agent manager not initialized or not configured');\n      return;\n    }\n\n    log('Updating agent instructions:', payload);\n\n    // Use UpdatePrompt message for the new agent API\n    agentManagerRef.current.sendJSON({\n      type: 'UpdatePrompt',\n      prompt: payload.instructions || payload.context || '',\n    });\n  };\n\n  // Clear all audio playback\n  const clearAudio = (): void => {\n    log(' clearAudio helper called');\n\n    if (!audioManagerRef.current) {\n      log(' Cannot clear audio: audioManagerRef.current is null');\n      return;\n    }\n\n    try {\n      log(' Calling audioManager.clearAudioQueue()');\n      audioManagerRef.current.clearAudioQueue();\n\n      // Additional audio cleanup\n      if (audioManagerRef.current['audioContext']) {\n        log(' Manipulating audio context time reference');\n        const ctx = audioManagerRef.current['audioContext'] as AudioContext;\n        try {\n          const silentBuffer = ctx.createBuffer(1, 1024, ctx.sampleRate);\n          const silentSource = ctx.createBufferSource();\n          silentSource.buffer = silentBuffer;\n          silentSource.connect(ctx.destination);\n          silentSource.start();\n        } catch (e) {\n          log(' Error creating silent buffer:', e);\n        }\n      }\n    } catch (err) {\n      log(' Error in clearAudio:', err);\n    }\n\n    log(' clearAudio helper completed');\n  };\n\n  // Interrupt the agent - only if agent is configured\n  const interruptAgent = (): void => {\n    log(' interruptAgent method called');\n\n    if (!agentManagerRef.current) {\n      log('Cannot interrupt agent: agent manager not initialized or not configured');\n      return;\n    }\n\n    clearAudio();\n    log(' Setting agent state to idle');\n    sleepLog('Dispatching AGENT_STATE_CHANGE to idle (from interruptAgent)');\n    dispatch({ type: 'AGENT_STATE_CHANGE', state: 'idle' });\n    log(' interruptAgent method completed');\n  };\n\n  // Put agent to sleep - only if agent is configured\n  const sleep = (): void => {\n    if (!agentManagerRef.current) {\n      log('Cannot put agent to sleep: agent manager not initialized or not configured');\n      return;\n    }\n\n    sleepLog('sleep() method called - initiating transition');\n    isWaitingForUserVoiceAfterSleep.current = true;\n    clearAudio();\n    sleepLog('Dispatching AGENT_STATE_CHANGE to entering_sleep (from sleep())');\n    dispatch({ type: 'AGENT_STATE_CHANGE', state: 'entering_sleep' });\n  };\n\n  // Wake agent from sleep - only if agent is configured\n  const wake = (): void => {\n    if (!agentManagerRef.current) {\n      log('Cannot wake agent: agent manager not initialized or not configured');\n      return;\n    }\n\n    if (stateRef.current.agentState !== 'sleeping') {\n      sleepLog(\n        `wake() called but state is ${stateRef.current.agentState}, not 'sleeping'. Aborting wake.`\n      );\n      return;\n    }\n\n    sleepLog('wake() method called from sleeping state');\n    isWaitingForUserVoiceAfterSleep.current = false;\n    sleepLog('Dispatching AGENT_STATE_CHANGE to listening (from wake())');\n    dispatch({ type: 'AGENT_STATE_CHANGE', state: 'listening' });\n  };\n\n  // Toggle between sleep and wake states - only if agent is configured\n  const toggleSleep = (): void => {\n    if (!agentManagerRef.current) {\n      log('Cannot toggle agent sleep state: agent manager not initialized or not configured');\n      return;\n    }\n\n    sleepLog('toggleSleep() method called. Current state via ref:', stateRef.current.agentState);\n    if (stateRef.current.agentState === 'sleeping') {\n      wake();\n    } else if (stateRef.current.agentState !== 'entering_sleep') {\n      sleep();\n    } else {\n      sleepLog('toggleSleep() called while already entering_sleep. No action.');\n    }\n    sleepLog('Sleep toggle action dispatched or ignored');\n  };\n\n  // Inject a message directly to the agent\n  const injectAgentMessage = (message: string): void => {\n    if (!agentManagerRef.current) {\n      log('Cannot inject message: agent manager not initialized or not configured');\n      return;\n    }\n\n    log('Injecting agent message:', message);\n\n    agentManagerRef.current.sendJSON({\n      type: 'InjectAgentMessage',\n      content: message,\n    });\n  };\n\n  // Expose methods via ref\n  useImperativeHandle(ref, () => ({\n    start,\n    stop,\n    updateAgentInstructions,\n    interruptAgent,\n    sleep,\n    wake,\n    toggleSleep,\n    injectAgentMessage,\n    startRecording: async () => {\n      if (!audioManagerRef.current) {\n        throw new Error('Audio manager not initialized');\n      }\n      return audioManagerRef.current.startRecording();\n    },\n    stopRecording: () => {\n      if (!audioManagerRef.current) {\n        log('Audio manager not initialized');\n        return;\n      }\n      audioManagerRef.current.stopRecording();\n    },\n    checkMicrophonePermissions: async () => {\n      if (!audioManagerRef.current) {\n        throw new Error('Audio manager not initialized');\n      }\n      return audioManagerRef.current.checkMicrophonePermissions();\n    },\n    getMicrophoneState: () => {\n      if (!audioManagerRef.current) {\n        return null;\n      }\n      return audioManagerRef.current.getMicrophoneState();\n    },\n  }));\n\n  // Render nothing (headless component)\n  return null;\n}\n\nexport default forwardRef(DeepgramVoiceInteraction);\n"]}