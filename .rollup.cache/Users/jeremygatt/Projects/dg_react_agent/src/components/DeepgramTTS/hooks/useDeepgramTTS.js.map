{"version":3,"file":"useDeepgramTTS.js","sourceRoot":"","sources":["useDeepgramTTS.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useRef, useState, useMemo } from 'react';\nimport { DeepgramTTSOptions, TTSMetrics, TTSError, DebugLevel } from '../../../types/tts';\nimport { ConnectionState } from '../../../types/common/connection';\nimport { WebSocketManager } from '../../../utils/websocket/WebSocketManager';\nimport { MessageHandler } from '../../../utils/tts/messageHandler';\nimport { ProtocolHandler } from '../../../utils/tts/protocolHandler';\nimport { AudioManager } from '../../../utils/audio/AudioManager';\nimport { MetricsCollector } from '../../../utils/tts/metricsCollector';\nimport { TTSWebSocketManager } from '../../../utils/websocket/TTSWebSocketManager';\n\ninterface UseDeepgramTTSReturn {\n  speak: (text: string) => Promise<void>;\n  streamText: (text: string) => Promise<void>;\n  flushStream: () => Promise<void>;\n  stop: () => void;\n  clear: () => Promise<void>;\n  isPlaying: boolean;\n  isConnected: boolean;\n  isReady: boolean;\n  error: TTSError | null;\n  metrics: TTSMetrics | null;\n}\n\nexport function useDeepgramTTS(\n  apiKey: string,\n  options: DeepgramTTSOptions = {}\n): UseDeepgramTTSReturn {\n  // State management\n  const [isPlaying] = useState(false);\n  const [isConnected, setIsConnected] = useState(false);\n  const [, setConnectionState] = useState<ConnectionState>('disconnected');\n  const [error, setError] = useState<TTSError | null>(null);\n  const [metrics] = useState<TTSMetrics | null>(null);\n  const [isReady, setIsReady] = useState(false);\n\n  // Refs for managers (prevent recreating on every render)\n  const websocketManagerRef = useRef<WebSocketManager | null>(null);\n  const messageHandlerRef = useRef<MessageHandler | null>(null);\n  const protocolHandlerRef = useRef<ProtocolHandler | null>(null);\n  const audioManagerRef = useRef<AudioManager | null>(null);\n  const metricsCollectorRef = useRef<MetricsCollector | null>(null);\n\n  // Smart debug level processing\n  const debugConfig = useMemo(() => {\n    const debugOption = options.debug;\n    \n    if (debugOption === false || debugOption === 'off') {\n      return { level: 'off' as DebugLevel, hookDebug: false, managerDebug: false };\n    }\n    \n    if (debugOption === true || debugOption === 'hook') {\n      return { level: 'hook' as DebugLevel, hookDebug: true, managerDebug: false };\n    }\n    \n    if (debugOption === 'manager') {\n      return { level: 'manager' as DebugLevel, hookDebug: true, managerDebug: true };\n    }\n    \n    if (debugOption === 'verbose') {\n      return { level: 'verbose' as DebugLevel, hookDebug: true, managerDebug: true };\n    }\n    \n    return { level: 'off' as DebugLevel, hookDebug: false, managerDebug: false };\n  }, [options.debug]);\n\n  // Centralized logging function\n  const log = useCallback((message: string, level: 'hook' | 'manager' | 'verbose' = 'hook') => {\n    if (debugConfig.level === 'off') return;\n    \n    if (level === 'hook' && debugConfig.hookDebug) {\n      console.log(`[DeepgramTTS] ${message}`);\n    } else if (level === 'manager' && debugConfig.level === 'manager') {\n      console.log(`[DeepgramTTS:Manager] ${message}`);\n    } else if (level === 'verbose' && debugConfig.level === 'verbose') {\n      console.log(`[DeepgramTTS:Verbose] ${message}`);\n    }\n  }, [debugConfig]);\n\n  // Memoized options to prevent unnecessary re-initializations\n  const memoizedOptions = useMemo(() => ({\n    enableMetrics: options.enableMetrics,\n    enableTextChunking: options.enableTextChunking,\n    maxChunkSize: options.maxChunkSize,\n    debugConfig,\n    onConnectionChange: options.onConnectionChange,\n    onError: options.onError,\n    onMetrics: options.onMetrics\n  }), [\n    options.enableMetrics,\n    options.enableTextChunking,\n    options.maxChunkSize,\n    debugConfig,\n    options.onConnectionChange,\n    options.onError,\n    options.onMetrics\n  ]);\n\n  // Initialize TTS system\n  useEffect(() => {\n    // Safety check: Don't initialize if no API key\n    if (!apiKey || apiKey.trim() === '') {\n      log('No API key provided, skipping initialization');\n      return;\n    }\n\n    let cleanup: (() => void) | undefined;\n\n    const initialize = async () => {\n      try {\n        log('üöÄ Initializing Deepgram TTS...');\n\n        // Initialize metrics collector\n        metricsCollectorRef.current = new MetricsCollector({\n          debug: memoizedOptions.debugConfig.managerDebug\n        });\n\n        // Initialize message handler\n        messageHandlerRef.current = new MessageHandler({\n          debug: memoizedOptions.debugConfig.managerDebug\n        }, {\n          onAudioData: (chunk) => {\n            log(`üì¶ Audio chunk received: ${chunk.data.byteLength} bytes`, 'verbose');\n\n            // Record metrics\n            if (metricsCollectorRef.current) {\n              metricsCollectorRef.current.markFirstByte();\n              metricsCollectorRef.current.addChunk(chunk.data.byteLength);\n            }\n\n            // Queue audio for playback\n            audioManagerRef.current?.queueAudio(chunk.data);\n          },\n          onMetadata: (metadata) => {\n            log('üìã Metadata received', 'hook');\n            log(`üìã Metadata details: ${JSON.stringify(metadata)}`, 'verbose');\n          },\n          onFlushed: () => {\n            log('‚úÖ Audio stream flushed', 'verbose');\n          },\n          onCleared: () => {\n            log('üßπ Audio queue cleared', 'verbose');\n          },\n          onError: (error) => {\n            log(`‚ùå Message handler error: ${error.message}`);\n            setError(error);\n            memoizedOptions.onError?.(error);\n          }\n        });\n\n        // Initialize protocol handler\n        protocolHandlerRef.current = new ProtocolHandler({\n          debug: memoizedOptions.debugConfig.managerDebug,\n          enableTextChunking: memoizedOptions.enableTextChunking,\n          maxChunkSize: memoizedOptions.maxChunkSize\n        });\n\n        // Initialize WebSocket manager\n        websocketManagerRef.current = new TTSWebSocketManager({\n          apiKey,\n          debug: memoizedOptions.debugConfig.managerDebug,\n          maxReconnectAttempts: 0,\n          reconnectDelay: 1000,\n          model: 'aura-2-thalia-en',\n          encoding: 'linear16',\n          sampleRate: 48000\n        }, {\n          onOpen: () => {\n            log('üîó Connected to Deepgram TTS');\n          },\n          onMessage: (data) => {\n            messageHandlerRef.current?.handleMessage(data);\n          },\n          onClose: () => {\n            log('üîå Disconnected from Deepgram TTS');\n          },\n          onError: (error) => {\n            log(`‚ùå Connection error: ${error.message}`);\n            setError(error);\n            memoizedOptions.onError?.(error);\n          },\n          onConnectionStateChange: (state) => {\n            // Only update state if it actually changed\n            setConnectionState(prevState => {\n              if (prevState !== state) {\n                const stateEmojis: Record<ConnectionState, string> = {\n                  'disconnected': '‚ö´',\n                  'connecting': 'üü°', \n                  'connected': 'üü¢',\n                  'error': 'üî¥',\n                  'closed': '‚ö™'\n                };\n                log(`${stateEmojis[state]} Connection: ${state}`);\n                \n                setIsConnected(state === 'connected');\n                memoizedOptions.onConnectionChange?.(state === 'connected');\n                return state;\n              }\n              return prevState;\n            });\n          }\n        });\n\n        // Initialize audio manager\n        audioManagerRef.current = new AudioManager({\n          debug: memoizedOptions.debugConfig.managerDebug\n        });\n\n        // Set up audio event handlers\n        const unsubscribe = audioManagerRef.current.addEventListener(event => {\n          if (event.type === 'ready') {\n            log('üîä Audio system ready');\n          } else if (event.type === 'playing') {\n            log('‚ñ∂Ô∏è Audio playback started', 'verbose');\n            if (metricsCollectorRef.current) {\n              metricsCollectorRef.current.markFirstAudio();\n            }\n          } else if (event.type === 'error' && event.error) {\n            log(`‚ùå Audio error: ${event.error.message}`);\n            setError(event.error);\n            memoizedOptions.onError?.(event.error);\n          }\n        });\n\n        cleanup = () => {\n          log('üßπ Cleaning up TTS resources', 'verbose');\n          unsubscribe();\n          audioManagerRef.current?.cleanup();\n          websocketManagerRef.current?.cleanup();\n        };\n\n        // Initialize audio manager\n        await audioManagerRef.current.initialize();\n\n        // Connect WebSocket\n        websocketManagerRef.current.connect();\n\n        // Start metrics collection\n        if (memoizedOptions.enableMetrics) {\n          metricsCollectorRef.current?.start();\n        }\n\n        // Set ready state\n        setIsReady(true);\n        log('‚úÖ Deepgram TTS ready!');\n      } catch (error) {\n        const ttsError = error as TTSError;\n        log(`‚ùå Initialization failed: ${ttsError.message}`);\n        setError(ttsError);\n        memoizedOptions.onError?.(ttsError);\n      }\n    };\n\n    initialize();\n\n    return () => {\n      cleanup?.();\n    };\n  }, [apiKey, memoizedOptions.debugConfig.level, memoizedOptions.enableMetrics, log, memoizedOptions]);\n\n  // Speak text\n  const speak = useCallback(async (text: string): Promise<void> => {\n    if (!isReady) {\n      throw new Error('TTS is not ready');\n    }\n\n    if (!text || text.trim().length === 0) {\n      throw new Error('Text cannot be empty');\n    }\n\n    try {\n      log(`üó£Ô∏è Speaking: \"${text.substring(0, 50)}${text.length > 50 ? '...' : ''}\"`);\n\n      // Start metrics collection\n      if (memoizedOptions.enableMetrics) {\n        metricsCollectorRef.current?.start();\n      }\n\n      // Create speak message\n      const message = protocolHandlerRef.current?.createSpeakMessage(text);\n      if (message && websocketManagerRef.current) {\n        websocketManagerRef.current.sendMessage(message);\n      }\n\n      // Create flush message\n      const flushMessage = protocolHandlerRef.current?.createFlushMessage();\n      if (flushMessage && websocketManagerRef.current) {\n        websocketManagerRef.current.sendMessage(flushMessage);\n      }\n    } catch (error) {\n      const ttsError = error as TTSError;\n      log(`‚ùå Speak failed: ${ttsError.message}`);\n      setError(ttsError);\n      memoizedOptions.onError?.(ttsError);\n      throw ttsError;\n    }\n  }, [isReady, memoizedOptions.enableMetrics, memoizedOptions.onError, log]);\n\n  // Stream text (for LLM streaming)\n  const streamText = useCallback(async (text: string): Promise<void> => {\n    if (!isReady) {\n      throw new Error('TTS is not ready');\n    }\n\n    if (!text || text.trim().length === 0) {\n      return;\n    }\n\n    try {\n      log(`üìù Streaming text: \"${text.substring(0, 30)}...\"`, 'verbose');\n\n      // Create speak message\n      const message = protocolHandlerRef.current?.createSpeakMessage(text);\n      if (message && websocketManagerRef.current) {\n        websocketManagerRef.current.sendMessage(message);\n      }\n    } catch (error) {\n      const ttsError = error as TTSError;\n      log(`‚ùå Stream failed: ${ttsError.message}`);\n      setError(ttsError);\n      memoizedOptions.onError?.(ttsError);\n      throw ttsError;\n    }\n  }, [isReady, memoizedOptions.onError, log]);\n\n  // Flush stream\n  const flushStream = useCallback(async (): Promise<void> => {\n    if (!isReady) {\n      throw new Error('TTS is not ready');\n    }\n\n    try {\n      log('üöø Flushing stream', 'verbose');\n\n      // Create flush message\n      const flushMessage = protocolHandlerRef.current?.createFlushMessage();\n      if (flushMessage && websocketManagerRef.current) {\n        websocketManagerRef.current.sendMessage(flushMessage);\n      }\n    } catch (error) {\n      const ttsError = error as TTSError;\n      log(`‚ùå Flush failed: ${ttsError.message}`);\n      setError(ttsError);\n      memoizedOptions.onError?.(ttsError);\n      throw ttsError;\n    }\n  }, [isReady, memoizedOptions.onError, log]);\n\n  // Clear audio\n  const clear = useCallback(async (): Promise<void> => {\n    if (!isReady) {\n      throw new Error('TTS is not ready');\n    }\n\n    try {\n      log('üßπ Clearing audio queue');\n\n      // Create clear message\n      const clearMessage = protocolHandlerRef.current?.createClearMessage();\n      if (clearMessage && websocketManagerRef.current) {\n        websocketManagerRef.current.sendMessage(clearMessage);\n      }\n\n      // Clear audio queue\n      audioManagerRef.current?.clearAudioQueue();\n    } catch (error) {\n      const ttsError = error as TTSError;\n      log(`‚ùå Clear failed: ${ttsError.message}`);\n      setError(ttsError);\n      memoizedOptions.onError?.(ttsError);\n      throw ttsError;\n    }\n  }, [isReady, memoizedOptions.onError, log]);\n\n  // Stop playback\n  const stop = useCallback((): void => {\n    log('‚èπÔ∏è Stopping playback', 'verbose');\n    audioManagerRef.current?.stop();\n    metricsCollectorRef.current?.reset();\n  }, [log]);\n\n  // Return hook interface\n  return {\n    speak,\n    streamText,\n    flushStream,\n    stop,\n    clear,\n    isPlaying,\n    isConnected,\n    isReady,\n    error,\n    metrics\n  };\n} "]}