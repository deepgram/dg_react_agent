{"version":3,"file":"useDeepgramTTS.js","sourceRoot":"","sources":["useDeepgramTTS.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useRef, useState, useMemo } from 'react';\nimport { TTSMetrics, TTSError, DebugLevel } from '../../../types/tts';\nimport { ConnectionState } from '../../../types/common/connection';\nimport { BaseWebSocketManager } from '../../../utils/shared/BaseWebSocketManager';\nimport { MessageHandler } from '../../../utils/tts/messageHandler';\nimport { ProtocolHandler } from '../../../utils/tts/protocolHandler';\nimport { AudioOutputManager } from '../../../utils/audio/AudioOutputManager';\nimport { MetricsCollector } from '../../../utils/tts/metricsCollector';\nimport { TTSWebSocketManager } from '../../../utils/websocket/TTSWebSocketManager';\nimport {\n  AUDIO_CONFIG,\n  WEBSOCKET_CONFIG,\n  MODEL_CONFIG,\n  DEBUG_CONFIG,\n  METRICS_CONFIG,\n  mergeConfig,\n  BaseComponentConfig\n} from '../../../utils/shared/config';\n\ninterface TTSConfig extends BaseComponentConfig {\n  enableTextChunking?: boolean;\n  maxChunkSize?: number;\n  model?: string;\n  onConnectionChange?: (isConnected: boolean) => void;\n  onError?: (error: TTSError) => void;\n  onMetrics?: (metrics: TTSMetrics) => void;\n}\n\nconst DEFAULT_TTS_CONFIG: TTSConfig = {\n  debug: DEBUG_CONFIG.defaultLevel,\n  enableMetrics: METRICS_CONFIG.enableByDefault,\n  enableTextChunking: false,\n  maxChunkSize: METRICS_CONFIG.chunkSizeLimit,\n  model: MODEL_CONFIG.tts.default\n};\n\ninterface UseDeepgramTTSReturn {\n  speak: (text: string) => Promise<void>;\n  streamText: (text: string) => Promise<void>;\n  flushStream: () => Promise<void>;\n  stop: () => void;\n  clear: () => Promise<void>;\n  disconnect: () => void;\n  isPlaying: boolean;\n  isConnected: boolean;\n  isReady: boolean;\n  error: TTSError | null;\n  metrics: TTSMetrics | null;\n}\n\n// Message Types\ntype DeepgramMessage = {\n  type: string;\n  [key: string]: any;\n};\n\nexport function useDeepgramTTS(\n  apiKey: string,\n  options: TTSConfig = {}\n): UseDeepgramTTSReturn {\n  // Merge configuration with defaults\n  const config = useMemo(() => mergeConfig(DEFAULT_TTS_CONFIG, options), [options]);\n\n  // State management\n  const [isConnected, setIsConnected] = useState(false);\n  const [isReady, setIsReady] = useState(false);\n  const [error, setError] = useState<TTSError | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [metrics, setMetrics] = useState<TTSMetrics | null>(null);\n  \n  // Cleanup state tracking\n  const isCleaningUpRef = useRef(false);\n\n  // Refs for managers (prevent recreating on every render)\n  const websocketManagerRef = useRef<BaseWebSocketManager | null>(null);\n  const messageHandlerRef = useRef<MessageHandler | null>(null);\n  const protocolHandlerRef = useRef<ProtocolHandler | null>(null);\n  const audioManagerRef = useRef<AudioOutputManager | null>(null);\n  const metricsCollectorRef = useRef<MetricsCollector | null>(null);\n\n  // Smart debug level processing\n  const debugConfig = useMemo(() => {\n    const config = {\n      level: 'off' as DebugLevel,\n      hookDebug: false,\n      managerDebug: false\n    };\n    \n    const debugOption = options.debug;\n    switch (debugOption) {\n      case true:\n      case 'hook':\n        return { ...config, level: 'hook', hookDebug: true };\n      case 'manager':\n        return { ...config, level: 'manager', hookDebug: true, managerDebug: true };\n      case 'verbose':\n        return { ...config, level: 'verbose', hookDebug: true, managerDebug: true };\n      default:\n        return config;\n    }\n  }, [options.debug]);\n\n  // Centralized logging function\n  const log = useCallback((message: string, level: 'hook' | 'manager' | 'verbose' = 'hook') => {\n    if (debugConfig.level === 'off') return;\n    \n    if (level === 'hook' && debugConfig.hookDebug) {\n      console.log(`[DeepgramTTS] ${message}`);\n    } else if (level === 'manager' && debugConfig.level === 'manager') {\n      console.log(`[DeepgramTTS:Manager] ${message}`);\n    } else if (level === 'verbose' && debugConfig.level === 'verbose') {\n      console.log(`[DeepgramTTS:Verbose] ${message}`);\n    }\n  }, [debugConfig]);\n\n  // Memoized options to prevent unnecessary re-initializations\n  const memoizedOptions = useMemo(() => ({\n    enableMetrics: config.enableMetrics,\n    enableTextChunking: config.enableTextChunking,\n    maxChunkSize: config.maxChunkSize,\n    debugConfig,\n    onConnectionChange: config.onConnectionChange,\n    onError: config.onError,\n    onMetrics: config.onMetrics\n  }), [\n    config.enableMetrics,\n    config.enableTextChunking,\n    config.maxChunkSize,\n    config.onConnectionChange,\n    config.onError,\n    config.onMetrics,\n    debugConfig\n  ]);\n\n  // Utility function to handle operation errors\n  const handleOperationError = useCallback((error: unknown, operation: string) => {\n    const ttsError = error as TTSError;\n    log(`âŒ ${operation} failed: ${ttsError.message}`);\n    setError(ttsError);\n    memoizedOptions.onError?.(ttsError);\n    throw ttsError;\n  }, [log, memoizedOptions.onError]);\n\n  // Initialize protocol handler\n  const initializeProtocolHandler = useCallback(() => {\n    protocolHandlerRef.current = new ProtocolHandler({\n      debug: memoizedOptions.debugConfig.managerDebug,\n      enableTextChunking: config.enableTextChunking,\n      maxChunkSize: config.maxChunkSize\n    });\n  }, [memoizedOptions.debugConfig.managerDebug, config.enableTextChunking, config.maxChunkSize]);\n\n  // Utility function to send WebSocket messages\n  const sendWebSocketMessage = useCallback((createMessage: () => DeepgramMessage | undefined | null) => {\n    try {\n      const message = createMessage();\n      log(`ðŸ“¤ Attempting to send message: ${JSON.stringify(message)}`, 'verbose');\n      \n      if (!message) {\n        log('âŒ Failed to create message - createMessage returned null/undefined');\n        return false;\n      }\n\n      if (!websocketManagerRef.current) {\n        log('âŒ Failed to send message - WebSocket manager is not initialized');\n        return false;\n      }\n\n      if (websocketManagerRef.current.getState() !== 'connected') {\n        log(`âŒ Failed to send message - WebSocket is not connected (state: ${websocketManagerRef.current.getState()})`);\n        return false;\n      }\n\n      websocketManagerRef.current.sendMessage(message);\n      log(`âœ… Message sent successfully: ${message.type}`, 'verbose');\n      return true;\n    } catch (error) {\n      log(`âŒ Error in sendWebSocketMessage: ${error instanceof Error ? error.message : 'Unknown error'}`);\n      return false;\n    }\n  }, [log]);\n\n  // Utility function to ensure the system is ready\n  const ensureReady = useCallback(() => {\n    if (!isReady) {\n      throw new Error('TTS is not ready');\n    }\n  }, [isReady]);\n\n  // Utility function to clean up resources\n  const cleanupResources = useCallback(() => {\n    // Prevent duplicate cleanups\n    if (isCleaningUpRef.current) {\n      log('ðŸ”„ Cleanup already in progress, skipping', 'verbose');\n      return;\n    }\n\n    isCleaningUpRef.current = true;\n    log('ðŸ§¹ Cleaning up TTS resources', 'verbose');\n    \n    // Stop and clean audio\n    if (audioManagerRef.current) {\n      audioManagerRef.current.stop();\n      audioManagerRef.current.clearAudioQueue();\n      audioManagerRef.current.cleanup();\n      audioManagerRef.current = null;\n    }\n    \n    // Clean up WebSocket\n    if (websocketManagerRef.current) {\n      websocketManagerRef.current.cleanup();\n      websocketManagerRef.current = null;\n    }\n\n    // Clean up other managers\n    if (metricsCollectorRef.current) {\n      metricsCollectorRef.current.reset();\n      metricsCollectorRef.current = null;\n    }\n\n    messageHandlerRef.current = null;\n    protocolHandlerRef.current = null;\n    \n    // Reset state\n    setIsConnected(false);\n    setIsReady(false);\n    setError(null);\n    setIsPlaying(false);\n    setMetrics(null);\n    \n    log('âœ… TTS system cleaned up');\n    \n    // Reset cleanup state after a short delay to allow for any pending cleanup operations\n    setTimeout(() => {\n      isCleaningUpRef.current = false;\n    }, 100);\n  }, [log]);\n\n  // Initialize metrics collector\n  const initializeMetrics = useCallback(() => {\n    metricsCollectorRef.current = new MetricsCollector({\n      debug: memoizedOptions.debugConfig.managerDebug\n    });\n  }, [memoizedOptions.debugConfig.managerDebug]);\n\n  // Initialize message handler\n  const initializeMessageHandler = useCallback(() => {\n    messageHandlerRef.current = new MessageHandler({\n      debug: memoizedOptions.debugConfig.managerDebug,\n      onAudioChunk: (chunk) => {\n        log(`ðŸ“¦ Audio chunk received: ${chunk.data.byteLength} bytes`, 'verbose');\n\n        if (metricsCollectorRef.current) {\n          metricsCollectorRef.current.markFirstByte();\n          metricsCollectorRef.current.addChunk(chunk.data.byteLength);\n        }\n\n        audioManagerRef.current?.queueAudio(chunk.data);\n      },\n      onComplete: () => {\n        log('âœ… Audio stream complete', 'verbose');\n      },\n      onError: (error) => {\n        handleOperationError(error, 'Message handler');\n      }\n    });\n  }, [log, handleOperationError, memoizedOptions.debugConfig.managerDebug]);\n\n  // Initialize WebSocket manager\n  const initializeWebSocket = useCallback(() => {\n    websocketManagerRef.current = new TTSWebSocketManager({\n      apiKey,\n      debug: memoizedOptions.debugConfig.managerDebug,\n      maxReconnectAttempts: WEBSOCKET_CONFIG.maxReconnectAttempts,\n      reconnectDelay: WEBSOCKET_CONFIG.reconnectDelay,\n      model: config.model || MODEL_CONFIG.tts.default,\n      encoding: AUDIO_CONFIG.encoding,\n      sampleRate: AUDIO_CONFIG.sampleRate\n    }, {\n      onOpen: () => {\n        log('ðŸ”— Connected to Deepgram TTS');\n      },\n      onMessage: (data) => {\n        messageHandlerRef.current?.handleMessage(data);\n      },\n      onClose: () => {\n        log('ðŸ”Œ Disconnected from Deepgram TTS');\n        setIsConnected(false);\n      },\n      onError: (error) => {\n        handleOperationError(error, 'WebSocket connection');\n      },\n      onConnectionStateChange: (state) => {\n        const stateEmojis: Record<ConnectionState, string> = {\n          'disconnected': 'âš«',\n          'connecting': 'ðŸŸ¡', \n          'connected': 'ðŸŸ¢',\n          'error': 'ðŸ”´',\n          'closed': 'âšª'\n        };\n        log(`${stateEmojis[state]} Connection: ${state}`);\n        \n        setIsConnected(state === 'connected');\n        memoizedOptions.onConnectionChange?.(state === 'connected');\n      }\n    });\n  }, [apiKey, memoizedOptions.debugConfig.managerDebug, config.model]);\n\n  // Initialize audio manager\n  const initializeAudio = useCallback(async () => {\n    audioManagerRef.current = new AudioOutputManager({\n      debug: memoizedOptions.debugConfig.managerDebug,\n      enableVolumeControl: true,\n      initialVolume: 1.0\n    }, {\n      onAudioStart: () => {\n        log('â–¶ï¸ Audio playback started', 'verbose');\n        setIsPlaying(true);\n        if (metricsCollectorRef.current) {\n          metricsCollectorRef.current.markFirstAudio();\n        }\n      },\n      onAudioEnd: () => {\n        setIsPlaying(false);\n      },\n      onError: (error) => handleOperationError(error, 'Audio system')\n    });\n\n    await audioManagerRef.current.initialize();\n  }, [memoizedOptions.debugConfig.managerDebug, log, handleOperationError]);\n\n  // Initialize TTS system\n  useEffect(() => {\n    isCleaningUpRef.current = false;\n\n    if (!apiKey || apiKey.trim() === '') {\n      log('No API key provided, skipping initialization');\n      return;\n    }\n\n    const initialize = async () => {\n      try {\n        log('ðŸš€ Initializing Deepgram TTS...');\n\n        initializeMetrics();\n        initializeMessageHandler();\n        initializeProtocolHandler();\n        initializeWebSocket();\n        await initializeAudio();\n\n        // Connect WebSocket\n        websocketManagerRef.current?.connect();\n\n        // Start metrics collection\n        if (memoizedOptions.enableMetrics) {\n          metricsCollectorRef.current?.start();\n        }\n\n        setIsReady(true);\n        log('âœ… Deepgram TTS ready!');\n      } catch (error) {\n        handleOperationError(error, 'Initialization');\n      }\n    };\n\n    initialize();\n\n    return () => {\n      if (!isCleaningUpRef.current) {\n        cleanupResources();\n      }\n    };\n  }, [\n    apiKey,\n    log,\n    memoizedOptions.enableMetrics,\n    initializeMetrics,\n    initializeMessageHandler,\n    initializeProtocolHandler,\n    initializeWebSocket,\n    initializeAudio,\n    cleanupResources,\n    handleOperationError\n  ]);\n\n  // Speak text\n  const speak = useCallback(async (text: string): Promise<void> => {\n    ensureReady();\n\n    if (!text || text.trim().length === 0) {\n      throw new Error('Text cannot be empty');\n    }\n\n    try {\n      log(`ðŸ—£ï¸ Speaking: \"${text.substring(0, 50)}${text.length > 50 ? '...' : ''}\"`);\n\n      if (memoizedOptions.enableMetrics) {\n        metricsCollectorRef.current?.start();\n      }\n\n      // Send speak message first\n      const speakSuccess = sendWebSocketMessage(() => protocolHandlerRef.current?.createSpeakMessage(text));\n      if (!speakSuccess) {\n        throw new Error('Failed to send speak message');\n      }\n\n      // Then send flush message\n      const flushSuccess = sendWebSocketMessage(() => protocolHandlerRef.current?.createFlushMessage());\n      if (!flushSuccess) {\n        throw new Error('Failed to send flush message');\n      }\n    } catch (error) {\n      handleOperationError(error, 'Speak');\n    }\n  }, [ensureReady, log, memoizedOptions.enableMetrics, sendWebSocketMessage, handleOperationError]);\n\n  // Stream text (for LLM streaming)\n  const streamText = useCallback(async (text: string): Promise<void> => {\n    ensureReady();\n\n    if (!text || text.trim().length === 0) {\n      return;\n    }\n\n    try {\n      log(`ðŸ“ Streaming text: \"${text.substring(0, 30)}...\"`, 'verbose');\n      sendWebSocketMessage(() => protocolHandlerRef.current?.createSpeakMessage(text));\n    } catch (error) {\n      handleOperationError(error, 'Stream');\n    }\n  }, [ensureReady, log, sendWebSocketMessage, handleOperationError]);\n\n  // Flush stream\n  const flushStream = useCallback(async (): Promise<void> => {\n    ensureReady();\n\n    try {\n      log('ðŸš¿ Flushing stream', 'verbose');\n      sendWebSocketMessage(() => protocolHandlerRef.current?.createFlushMessage());\n    } catch (error) {\n      handleOperationError(error, 'Flush');\n    }\n  }, [ensureReady, log, sendWebSocketMessage, handleOperationError]);\n\n  // Clear audio\n  const clear = useCallback(async (): Promise<void> => {\n    ensureReady();\n\n    try {\n      log('ðŸ§¹ Clearing audio queue');\n      sendWebSocketMessage(() => protocolHandlerRef.current?.createClearMessage());\n      audioManagerRef.current?.clearAudioQueue();\n    } catch (error) {\n      handleOperationError(error, 'Clear');\n    }\n  }, [ensureReady, log, sendWebSocketMessage, handleOperationError]);\n\n  // Stop playback\n  const stop = useCallback((): void => {\n    log('â¹ï¸ Stopping playback', 'verbose');\n    audioManagerRef.current?.stop();\n    metricsCollectorRef.current?.reset();\n    setIsPlaying(false);\n  }, [log]);\n\n  // Disconnect and cleanup\n  const disconnect = useCallback((): void => {\n    log('ðŸ”Œ Disconnecting TTS system');\n    if (!isCleaningUpRef.current) {\n      cleanupResources();\n    }\n  }, [log, cleanupResources]);\n\n  return {\n    speak,\n    streamText,\n    flushStream,\n    stop,\n    clear,\n    disconnect,\n    isPlaying,\n    isConnected,\n    isReady,\n    error,\n    metrics\n  };\n} "]}