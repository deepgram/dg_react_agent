{"version":3,"file":"useDeepgramAgent.js","sourceRoot":"","sources":["useDeepgramAgent.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\nimport { useAudioInput } from '../../../hooks/useAudio/useAudioInput';\nimport { useWebSocketConnection } from '../../../hooks/useWebSocket/useWebSocketConnection';\nimport { VoiceWebSocketManager } from '../../../utils/websocket/VoiceWebSocketManager';\nimport { AgentState, AgentOptions, TranscriptResponse, LLMResponse, UserMessageResponse, UpdateInstructionsPayload } from '../../../types/voice';\nimport { VoiceError } from '../../../types/voice/error';\nimport { AUDIO_CONFIG, MICROPHONE_CONFIG } from '../../../utils/shared/config';\n\ninterface UseDeepgramAgentOptions {\n  apiKey: string;\n  transcriptionOptions?: Record<string, any>;\n  agentOptions?: AgentOptions;\n  microphoneConfig?: Partial<typeof MICROPHONE_CONFIG>;\n  autoInitialize?: boolean; // New option to control automatic initialization\n  debug?: boolean;\n  onReady?: (isReady: boolean) => void;\n  onTranscriptUpdate?: (transcript: TranscriptResponse) => void;\n  onAgentUtterance?: (response: LLMResponse) => void;\n  onUserMessage?: (message: UserMessageResponse) => void;\n  onAgentStateChange?: (state: AgentState) => void;\n  onError?: (error: VoiceError) => void;\n}\n\ninterface UseDeepgramAgentReturn {\n  initialize: () => Promise<void>; // New method for manual initialization\n  start: () => Promise<void>;\n  stop: () => Promise<void>;\n  updateAgentInstructions: (payload: UpdateInstructionsPayload) => void;\n  interruptAgent: () => void;\n  sleep: () => void;\n  wake: () => void;\n  toggleSleep: () => void;\n  injectAgentMessage: (text: string) => void;\n  isReady: boolean;\n  isRecording: boolean;\n  agentState: AgentState;\n  error: VoiceError | null;\n}\n\n/**\n * Hook for Deepgram agent functionality.\n * Composes base hooks for audio and WebSocket management.\n */\nexport function useDeepgramAgent(options: UseDeepgramAgentOptions): UseDeepgramAgentReturn {\n  // State\n  const [isReady, setIsReady] = useState(false);\n  const [error, setError] = useState<VoiceError | null>(null);\n  const [agentState, setAgentState] = useState<AgentState>('idle');\n  const isCleaningUpRef = useRef(false);\n  const optionsRef = useRef(options);\n\n  // Update options ref when they change\n  useEffect(() => {\n    optionsRef.current = options;\n  }, [options]);\n\n  // Logging utility\n  const log = useCallback((message: string) => {\n    if (optionsRef.current.debug) {\n      console.log(`[useDeepgramAgent] ${message}`);\n    }\n  }, []);\n\n  // Create WebSocket managers\n  const transcriptionManager = useRef<VoiceWebSocketManager | null>(null);\n  const agentManager = useRef<VoiceWebSocketManager | null>(null);\n\n  // Initialize managers\n  const createManagers = useCallback(() => {\n    if (!optionsRef.current.apiKey || isCleaningUpRef.current) return;\n\n    // Only create managers if they don't exist\n    if (!transcriptionManager.current) {\n      transcriptionManager.current = new VoiceWebSocketManager({\n        type: 'transcription',\n        apiKey: optionsRef.current.apiKey,\n        model: optionsRef.current.transcriptionOptions?.model || 'nova-2',\n        encoding: AUDIO_CONFIG.encoding,\n        sampleRate: AUDIO_CONFIG.sampleRate,\n        debug: optionsRef.current.debug\n      });\n    }\n\n    if (!agentManager.current) {\n      agentManager.current = new VoiceWebSocketManager({\n        type: 'agent',\n        apiKey: optionsRef.current.apiKey,\n        debug: optionsRef.current.debug\n      });\n    }\n  }, []);\n\n  // Cleanup function\n  const cleanup = useCallback(() => {\n    if (isCleaningUpRef.current) {\n      if (transcriptionManager.current) {\n        transcriptionManager.current.cleanup();\n        transcriptionManager.current = null;\n      }\n      if (agentManager.current) {\n        agentManager.current.cleanup();\n        agentManager.current = null;\n      }\n      setIsReady(false);\n    }\n  }, []);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      isCleaningUpRef.current = true;\n      cleanup();\n    };\n  }, [cleanup]);\n\n  // Use base hooks\n  const {\n    initialize: initializeMicrophone,\n    startRecording,\n    stopRecording,\n    isRecording,\n    error: audioError\n  } = useAudioInput({\n    debug: optionsRef.current.debug,\n    microphoneConfig: optionsRef.current.microphoneConfig,\n    autoInitialize: false, // We'll handle initialization ourselves\n    onMicrophoneData: (data) => {\n      if (transcriptionManager.current?.isConnected()) {\n        transcriptionManager.current.sendBinary(data);\n      }\n    },\n    onError: (error) => {\n      setError(new VoiceError('audio_error', { originalError: error }));\n      optionsRef.current.onError?.(new VoiceError('audio_error', { originalError: error }));\n    }\n  });\n\n  const {\n    connect: connectTranscription,\n    disconnect: disconnectTranscription,\n    error: transcriptionError\n  } = useWebSocketConnection(transcriptionManager.current, {\n    debug: optionsRef.current.debug,\n    onError: (error) => {\n      setError(new VoiceError('transcription_error', { originalError: error }));\n      optionsRef.current.onError?.(new VoiceError('transcription_error', { originalError: error }));\n    }\n  });\n\n  const {\n    connect: connectAgent,\n    disconnect: disconnectAgent,\n    sendMessage: sendAgentMessage,\n    error: agentError\n  } = useWebSocketConnection(agentManager.current, {\n    debug: optionsRef.current.debug,\n    onError: (error) => {\n      setError(new VoiceError('agent_error', { originalError: error }));\n      optionsRef.current.onError?.(new VoiceError('agent_error', { originalError: error }));\n    }\n  });\n\n  // Handle errors from base hooks\n  useEffect(() => {\n    if (audioError) {\n      setError(new VoiceError('audio_error', { originalError: audioError }));\n      optionsRef.current.onError?.(new VoiceError('audio_error', { originalError: audioError }));\n    } else if (transcriptionError) {\n      setError(new VoiceError('transcription_error', { originalError: transcriptionError }));\n      optionsRef.current.onError?.(new VoiceError('transcription_error', { originalError: transcriptionError }));\n    } else if (agentError) {\n      setError(new VoiceError('agent_error', { originalError: agentError }));\n      optionsRef.current.onError?.(new VoiceError('agent_error', { originalError: agentError }));\n    }\n  }, [audioError, transcriptionError, agentError]);\n\n  // Initialize function that sets up everything\n  const initialize = useCallback(async () => {\n    try {\n      if (!optionsRef.current.apiKey) {\n        throw new VoiceError('invalid_configuration', { \n          originalError: new Error('API key is required') \n        });\n      }\n\n      // Create WebSocket managers\n      createManagers();\n\n      // Initialize microphone\n      await initializeMicrophone();\n\n      setIsReady(true);\n      log('✅ Agent system ready');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('initialization_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n      throw voiceError;\n    }\n  }, [createManagers, initializeMicrophone, log]);\n\n  // Auto-initialize if enabled\n  useEffect(() => {\n    if (optionsRef.current.autoInitialize && !isCleaningUpRef.current) {\n      initialize().catch(() => {}); // Errors are already handled in initialize\n    }\n  }, [initialize]);\n\n  // Start interaction\n  const start = useCallback(async () => {\n    try {\n      // Initialize if not ready\n      if (!isReady) {\n        await initialize();\n      }\n\n      // Connect WebSocket managers\n      connectTranscription();\n      connectAgent();\n\n      // Start recording\n      await startRecording();\n\n      log('✅ Agent started');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('start_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n      throw voiceError;\n    }\n  }, [initialize, isReady, connectTranscription, connectAgent, startRecording, log]);\n\n  // Stop interaction\n  const stop = useCallback(async () => {\n    try {\n      // Stop recording first\n      stopRecording();\n\n      // Then disconnect WebSockets\n      disconnectTranscription();\n      disconnectAgent();\n\n      log('✅ Agent stopped');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('stop_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n      throw voiceError;\n    }\n  }, [stopRecording, disconnectTranscription, disconnectAgent, log]);\n\n  // Agent control methods\n  const updateAgentInstructions = useCallback((payload: UpdateInstructionsPayload) => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      sendAgentMessage({\n        type: 'UpdateInstructions',\n        instructions: payload.instructions,\n        context: payload.context\n      });\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('update_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage]);\n\n  const interruptAgent = useCallback(() => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      sendAgentMessage({ type: 'Interrupt' });\n      setAgentState('idle');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('interrupt_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage]);\n\n  const sleep = useCallback(() => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      sendAgentMessage({ type: 'Sleep' });\n      setAgentState('sleeping');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('sleep_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage]);\n\n  const wake = useCallback(() => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      if (agentState !== 'sleeping') {\n        throw new VoiceError('agent_not_sleeping');\n      }\n      sendAgentMessage({ type: 'Wake' });\n      setAgentState('listening');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('wake_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage, agentState]);\n\n  const toggleSleep = useCallback(() => {\n    if (agentState === 'sleeping') {\n      wake();\n    } else {\n      sleep();\n    }\n  }, [agentState, wake, sleep]);\n\n  const injectAgentMessage = useCallback((text: string) => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      sendAgentMessage({\n        type: 'InjectMessage',\n        text\n      });\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('inject_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage]);\n\n  return {\n    initialize,\n    start,\n    stop,\n    updateAgentInstructions,\n    interruptAgent,\n    sleep,\n    wake,\n    toggleSleep,\n    injectAgentMessage,\n    isReady,\n    isRecording,\n    agentState,\n    error\n  };\n} "]}