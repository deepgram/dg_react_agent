{"version":3,"file":"VoiceWebSocketManager.js","sourceRoot":"","sources":["VoiceWebSocketManager.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,oBAAoB,EAAE,MAAM,gCAAgC,CAAC;AAYtE;IAA2C,yCAAoB;IAQ7D,+BACE,OAA8B,EAC9B,QAAqC;QAArC,yBAAA,EAAA,aAAqC;QAFvC,YAIE,wCACK,OAAO,KACV,GAAG,EAAE,qBAAqB,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,KACjD,QAAQ,CAAC,SAEb;QADC,KAAI,CAAC,YAAY,GAAG,OAAO,CAAC;;IAC9B,CAAC;IAEkB,iDAAiB,GAApC;QACE,IAAM,GAAG,GAAG,IAAI,GAAG,CAAC,qBAAqB,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;QAE7E,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,KAAK,eAAe,EAAE;YAC9C,IAAI,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE;gBAC3B,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;aAC3D;YACD,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE;gBAC9B,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,UAAU,EAAE,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;aACjE;YACD,IAAI,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE;gBAChC,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC,CAAC;aACjF;SACF;QAED,OAAO,GAAG,CAAC,QAAQ,EAAE,CAAC;IACxB,CAAC;IAEM,wCAAQ,GAAf,UAAgB,OAAY;QAC1B,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;IAC5B,CAAC;IAEM,+CAAe,GAAtB;QACE,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,KAAK,eAAe,EAAE;YAC9C,IAAI,CAAC,WAAW,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,CAAC,CAAC;SAC3C;IACH,CAAC;IAEM,iDAAiB,GAAxB,UAAyB,QAAa;QACpC,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,KAAK,OAAO,EAAE;YACtC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;SAC5B;IACH,CAAC;IAlDuB,+BAAS,GAAG;QAClC,aAAa,EAAE,kCAAkC;QACjD,KAAK,EAAE,4CAA4C;KACpD,CAAC;IAgDJ,4BAAC;CAAA,AApDD,CAA2C,oBAAoB,GAoD9D;SApDY,qBAAqB","sourcesContent":["import { BaseWebSocketManager } from '../shared/BaseWebSocketManager';\nimport { WebSocketManagerOptions, WebSocketEventHandlers } from '../../types/common/connection';\nimport { AgentOptions } from '../../types/voice';\n\ninterface VoiceWebSocketOptions extends Omit<WebSocketManagerOptions, 'url'> {\n  type: 'transcription' | 'agent';\n  model?: string;\n  encoding?: string;\n  sampleRate?: number;\n  agentOptions?: AgentOptions;\n}\n\nexport class VoiceWebSocketManager extends BaseWebSocketManager {\n  private static readonly BASE_URLS = {\n    transcription: 'wss://api.deepgram.com/v1/listen',\n    agent: 'wss://agent.deepgram.com/v1/agent/converse'\n  };\n\n  private voiceOptions: VoiceWebSocketOptions;\n\n  constructor(\n    options: VoiceWebSocketOptions,\n    handlers: WebSocketEventHandlers = {}\n  ) {\n    super({\n      ...options,\n      url: VoiceWebSocketManager.BASE_URLS[options.type]\n    }, handlers);\n    this.voiceOptions = options;\n  }\n\n  protected override buildWebSocketURL(): string {\n    const url = new URL(VoiceWebSocketManager.BASE_URLS[this.voiceOptions.type]);\n\n    if (this.voiceOptions.type === 'transcription') {\n      if (this.voiceOptions.model) {\n        url.searchParams.append('model', this.voiceOptions.model);\n      }\n      if (this.voiceOptions.encoding) {\n        url.searchParams.append('encoding', this.voiceOptions.encoding);\n      }\n      if (this.voiceOptions.sampleRate) {\n        url.searchParams.append('sample_rate', this.voiceOptions.sampleRate.toString());\n      }\n    }\n\n    return url.toString();\n  }\n\n  public sendJSON(message: any): void {\n    this.sendMessage(message);\n  }\n\n  public sendCloseStream(): void {\n    if (this.voiceOptions.type === 'transcription') {\n      this.sendMessage({ type: 'CloseStream' });\n    }\n  }\n\n  public sendAgentSettings(settings: any): void {\n    if (this.voiceOptions.type === 'agent') {\n      this.sendMessage(settings);\n    }\n  }\n} "]}