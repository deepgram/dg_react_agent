{"version":3,"file":"messageHandler.js","sourceRoot":"","sources":["messageHandler.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,QAAQ,EAAE,MAAM,0BAA0B,CAAC;AASpD;IAIE,wBAAY,OAAmC;QAAnC,wBAAA,EAAA,YAAmC;QAFvC,eAAU,GAAG,CAAC,CAAC;QAGrB,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;IAC1B,CAAC;IAEO,4BAAG,GAAX,UAAY,OAAe;QACzB,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE;YACvB,OAAO,CAAC,GAAG,CAAC,8BAAuB,OAAO,CAAE,CAAC,CAAC;SAC/C;IACH,CAAC;IAEM,sCAAa,GAApB,UAAqB,OAA0C;;QAC7D,IAAI,OAAO,YAAY,WAAW,EAAE;YAClC,IAAI,OAAO,CAAC,UAAU,KAAK,CAAC,EAAE;gBAC5B,OAAO;aACR;YAED,IAAM,UAAU,GAAe;gBAC7B,IAAI,EAAE,OAAO;gBACb,SAAS,EAAE,WAAW,CAAC,GAAG,EAAE;gBAC5B,UAAU,EAAE,IAAI,CAAC,UAAU,EAAE;aAC9B,CAAC;YAEF,MAAA,MAAA,IAAI,CAAC,QAAQ,EAAC,YAAY,mDAAG,UAAU,CAAC,CAAC;YACzC,OAAO;SACR;QAED,IAAI,OAAO,CAAC,IAAI,KAAK,OAAO,EAAE;YAC5B,IAAM,KAAK,GAAG,IAAI,QAAQ,CAAC,oBAAoB,EAAE;gBAC/C,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,GAAG;gBACf,UAAU,EAAE,OAAO,CAAC,QAAQ;gBAC5B,aAAa,EAAE,IAAI,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC;aAC1C,CAAC,CAAC;YACH,MAAA,MAAA,IAAI,CAAC,QAAQ,EAAC,OAAO,mDAAG,KAAK,CAAC,CAAC;YAC/B,OAAO;SACR;QAED,IAAI,OAAO,CAAC,IAAI,KAAK,UAAU,EAAE;YAC/B,MAAA,MAAA,IAAI,CAAC,QAAQ,EAAC,UAAU,kDAAI,CAAC;YAC7B,OAAO;SACR;QAED,IAAI,CAAC,GAAG,CAAC,gCAAyB,OAAO,CAAC,IAAI,CAAE,CAAC,CAAC;IACpD,CAAC;IAEM,sCAAa,GAApB;QACE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;IACtB,CAAC;IAEM,6CAAoB,GAA3B;QACE,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IACH,qBAAC;AAAD,CAAC,AAxDD,IAwDC","sourcesContent":["import { DeepgramTTSResponse, TTSError, AudioChunk } from '../../types/tts';\nimport { APIError } from '../../types/common/error';\n\ninterface MessageHandlerOptions {\n  onError?: (error: TTSError) => void;\n  onAudioChunk?: (chunk: AudioChunk) => void;\n  onComplete?: () => void;\n  debug?: boolean;\n}\n\nexport class MessageHandler {\n  private handlers: MessageHandlerOptions;\n  private sequenceId = 0;\n\n  constructor(options: MessageHandlerOptions = {}) {\n    this.handlers = options;\n  }\n\n  private log(message: string): void {\n    if (this.handlers.debug) {\n      console.log(`[TTSMessageHandler] ${message}`);\n    }\n  }\n\n  public handleMessage(message: DeepgramTTSResponse | ArrayBuffer): void {\n    if (message instanceof ArrayBuffer) {\n      if (message.byteLength === 0) {\n        return;\n      }\n\n      const audioChunk: AudioChunk = {\n        data: message,\n        timestamp: performance.now(),\n        sequenceId: this.sequenceId++\n      };\n\n      this.handlers.onAudioChunk?.(audioChunk);\n      return;\n    }\n\n    if (message.type === 'Error') {\n      const error = new APIError('Deepgram API error', {\n        endpoint: 'tts',\n        statusCode: 400,\n        statusText: message.err_code,\n        originalError: new Error(message.err_msg)\n      });\n      this.handlers.onError?.(error);\n      return;\n    }\n\n    if (message.type === 'Complete') {\n      this.handlers.onComplete?.();\n      return;\n    }\n\n    this.log(`Unknown message type: ${message.type}`);\n  }\n\n  public resetSequence(): void {\n    this.sequenceId = 0;\n  }\n\n  public getCurrentSequenceId(): number {\n    return this.sequenceId;\n  }\n} "]}