{"version":3,"file":"metricsCollector.js","sourceRoot":"","sources":["metricsCollector.ts"],"names":[],"mappings":"AAMA;IAOE,0BAAoB,OAAqC;QAArC,wBAAA,EAAA,YAAqC;QAArC,YAAO,GAAP,OAAO,CAA8B;QANjD,cAAS,GAAkB,IAAI,CAAC;QAChC,kBAAa,GAAkB,IAAI,CAAC;QACpC,mBAAc,GAAkB,IAAI,CAAC;QACrC,eAAU,GAAG,CAAC,CAAC;QACf,eAAU,GAAG,CAAC,CAAC;IAEqC,CAAC;IAItD,gCAAK,GAAZ;QACE,IAAI,CAAC,SAAS,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;QACnC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QACpB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QAEpB,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE;YACtB,OAAO,CAAC,GAAG,CAAC,+CAA+C,CAAC,CAAC;SAC9D;IACH,CAAC;IAEM,wCAAa,GAApB;QACE,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YACzC,IAAI,CAAC,aAAa,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;SACxC;IACH,CAAC;IAEM,yCAAc,GAArB;QACE,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;YAC1C,IAAI,CAAC,cAAc,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;SACzC;IACH,CAAC;IAEM,mCAAQ,GAAf,UAAgB,KAAa;QAC3B,IAAI,CAAC,UAAU,IAAI,KAAK,CAAC;QACzB,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAEM,qCAAU,GAAjB;QACE,IAAM,GAAG,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;QAC9B,IAAM,SAAS,GAAG,IAAI,CAAC,SAAS,IAAI,GAAG,CAAC;QAExC,OAAO;YACL,aAAa,EAAE,GAAG,GAAG,SAAS;YAC9B,gBAAgB,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;YACzE,iBAAiB,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;YAC5E,UAAU,EAAE,IAAI,CAAC,UAAU;YAC3B,gBAAgB,EAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAC7E,UAAU,EAAE,IAAI,CAAC,UAAU;SAC5B,CAAC;IACJ,CAAC;IAEM,gCAAK,GAAZ;QACE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QACpB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;IACtB,CAAC;IACH,uBAAC;AAAD,CAAC,AA7DD,IA6DC","sourcesContent":["import { TTSMetrics } from '../../types/tts';\n\ninterface MetricsCollectorOptions {\n  debug?: boolean;\n}\n\nexport class MetricsCollector {\n  private startTime: number | null = null;\n  private firstByteTime: number | null = null;\n  private firstAudioTime: number | null = null;\n  private totalBytes = 0;\n  private chunkCount = 0;\n\n  constructor(private options: MetricsCollectorOptions = {}) {}\n\n\n\n  public start(): void {\n    this.startTime = performance.now();\n    this.firstByteTime = null;\n    this.firstAudioTime = null;\n    this.totalBytes = 0;\n    this.chunkCount = 0;\n    \n    if (this.options.debug) {\n      console.log('[MetricsCollector] Started collecting metrics');\n    }\n  }\n\n  public markFirstByte(): void {\n    if (this.startTime && !this.firstByteTime) {\n      this.firstByteTime = performance.now();\n    }\n  }\n\n  public markFirstAudio(): void {\n    if (this.startTime && !this.firstAudioTime) {\n      this.firstAudioTime = performance.now();\n    }\n  }\n\n  public addChunk(bytes: number): void {\n    this.totalBytes += bytes;\n    this.chunkCount++;\n  }\n\n  public getMetrics(): TTSMetrics {\n    const now = performance.now();\n    const startTime = this.startTime || now;\n\n    return {\n      totalDuration: now - startTime,\n      firstByteLatency: this.firstByteTime ? this.firstByteTime - startTime : 0,\n      firstAudioLatency: this.firstAudioTime ? this.firstAudioTime - startTime : 0,\n      totalBytes: this.totalBytes,\n      averageChunkSize: this.chunkCount > 0 ? this.totalBytes / this.chunkCount : 0,\n      chunkCount: this.chunkCount\n    };\n  }\n\n  public reset(): void {\n    this.startTime = null;\n    this.firstByteTime = null;\n    this.firstAudioTime = null;\n    this.totalBytes = 0;\n    this.chunkCount = 0;\n  }\n} "]}