{"version":3,"file":"VoiceInteractionState.js","sourceRoot":"","sources":["VoiceInteractionState.ts"],"names":[],"mappings":";AAuBA,MAAM,CAAC,IAAM,YAAY,GAA0B;IACjD,OAAO,EAAE,KAAK;IACd,WAAW,EAAE,KAAK;IAClB,SAAS,EAAE,KAAK;IAChB,UAAU,EAAE,MAAM;IAClB,gBAAgB,EAAE;QAChB,aAAa,EAAE,cAAc;QAC7B,KAAK,EAAE,cAAc;KACtB;IACD,KAAK,EAAE,IAAI;CACZ,CAAC;AAEF,MAAM,UAAU,YAAY,CAAC,KAA4B,EAAE,KAAiB;;IAC1E,QAAQ,KAAK,CAAC,IAAI,EAAE;QAClB,KAAK,oBAAoB;YACvB,6BAAY,KAAK,KAAE,OAAO,EAAE,KAAK,CAAC,OAAO,IAAG;QAE9C,KAAK,wBAAwB;YAC3B,6BAAY,KAAK,KAAE,WAAW,EAAE,KAAK,CAAC,WAAW,IAAG;QAEtD,KAAK,uBAAuB;YAC1B,6BAAY,KAAK,KAAE,SAAS,EAAE,KAAK,CAAC,SAAS,IAAG;QAElD,KAAK,oBAAoB;YACvB,6BAAY,KAAK,KAAE,UAAU,EAAE,KAAK,CAAC,KAAK,IAAG;QAE/C,KAAK,yBAAyB;YAC5B,6BACK,KAAK,KACR,gBAAgB,wBACX,KAAK,CAAC,gBAAgB,gBACxB,KAAK,CAAC,OAAO,IAAG,KAAK,CAAC,KAAK,UAE9B;QAEJ,KAAK,OAAO;YACV,6BAAY,KAAK,KAAE,KAAK,EAAE,KAAK,CAAC,OAAO,IAAG;QAE5C;YACE,OAAO,KAAK,CAAC;KAChB;AACH,CAAC;AAED,MAAM,CAAC,IAAM,YAAY,GAAG;IAC1B,gBAAgB,EAAE,UAAC,KAA4B;QAC7C,OAAO,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,KAAK,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,KAAK,WAAW,EAAtB,CAAsB,CAAC,CAAC;IACvF,CAAC;IAED,kBAAkB,EAAE,UAAC,KAA4B;QAC/C,OAAO,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,KAAK,OAAO,EAAlB,CAAkB,CAAC,CAAC;IAClF,CAAC;IAED,uBAAuB,EAAE,UAAC,KAA4B;QACpD,IAAI,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,KAAK,OAAO,EAAlB,CAAkB,CAAC,EAAE;YAC5E,OAAO,OAAO,CAAC;SAChB;QAED,IAAI,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,KAAK,YAAY,EAAvB,CAAuB,CAAC,EAAE;YACjF,OAAO,YAAY,CAAC;SACrB;QAED,IAAI,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,KAAK,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,KAAK,WAAW,EAAtB,CAAsB,CAAC,EAAE;YACjF,OAAO,WAAW,CAAC;SACpB;QAED,OAAO,cAAc,CAAC;IACxB,CAAC;CACF,CAAC","sourcesContent":["import { AgentState, ServiceType } from '../../types/voice';\nimport { ConnectionState } from '../../types/common/connection';\n\nexport interface VoiceInteractionState {\n  isReady: boolean;\n  isRecording: boolean;\n  isPlaying: boolean;\n  agentState: AgentState;\n  connectionStates: {\n    transcription: ConnectionState;\n    agent: ConnectionState;\n  };\n  error: string | null;\n}\n\nexport type StateEvent =\n  | { type: 'READY_STATE_CHANGE'; isReady: boolean }\n  | { type: 'RECORDING_STATE_CHANGE'; isRecording: boolean }\n  | { type: 'PLAYBACK_STATE_CHANGE'; isPlaying: boolean }\n  | { type: 'AGENT_STATE_CHANGE'; state: AgentState }\n  | { type: 'CONNECTION_STATE_CHANGE'; service: ServiceType; state: ConnectionState }\n  | { type: 'ERROR'; message: string | null };\n\nexport const initialState: VoiceInteractionState = {\n  isReady: false,\n  isRecording: false,\n  isPlaying: false,\n  agentState: 'idle',\n  connectionStates: {\n    transcription: 'disconnected',\n    agent: 'disconnected',\n  },\n  error: null,\n};\n\nexport function stateReducer(state: VoiceInteractionState, event: StateEvent): VoiceInteractionState {\n  switch (event.type) {\n    case 'READY_STATE_CHANGE':\n      return { ...state, isReady: event.isReady };\n\n    case 'RECORDING_STATE_CHANGE':\n      return { ...state, isRecording: event.isRecording };\n\n    case 'PLAYBACK_STATE_CHANGE':\n      return { ...state, isPlaying: event.isPlaying };\n\n    case 'AGENT_STATE_CHANGE':\n      return { ...state, agentState: event.state };\n\n    case 'CONNECTION_STATE_CHANGE':\n      return {\n        ...state,\n        connectionStates: {\n          ...state.connectionStates,\n          [event.service]: event.state,\n        },\n      };\n\n    case 'ERROR':\n      return { ...state, error: event.message };\n\n    default:\n      return state;\n  }\n}\n\nexport const stateHelpers = {\n  isFullyConnected: (state: VoiceInteractionState): boolean => {\n    return Object.values(state.connectionStates).every(status => status === 'connected');\n  },\n\n  hasConnectionError: (state: VoiceInteractionState): boolean => {\n    return Object.values(state.connectionStates).some(status => status === 'error');\n  },\n\n  overallConnectionStatus: (state: VoiceInteractionState): ConnectionState => {\n    if (Object.values(state.connectionStates).some(status => status === 'error')) {\n      return 'error';\n    }\n\n    if (Object.values(state.connectionStates).some(status => status === 'connecting')) {\n      return 'connecting';\n    }\n\n    if (Object.values(state.connectionStates).every(status => status === 'connected')) {\n      return 'connected';\n    }\n\n    return 'disconnected';\n  },\n};\n"]}