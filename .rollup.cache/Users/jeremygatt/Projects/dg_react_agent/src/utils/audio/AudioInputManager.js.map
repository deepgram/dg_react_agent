{"version":3,"file":"AudioInputManager.js","sourceRoot":"","sources":["AudioInputManager.ts"],"names":[],"mappings":"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","sourcesContent":["import { BaseAudioManager, BaseAudioManagerOptions, BaseAudioEventHandlers } from '../shared/BaseAudioManager';\nimport { MicrophoneManager } from './MicrophoneManager';\nimport { MicrophoneConfig, MicrophoneEventHandlers } from '../../types/common/microphone';\n\nexport interface AudioInputManagerOptions extends BaseAudioManagerOptions {\n  microphoneConfig?: Partial<MicrophoneConfig>;\n}\n\nexport interface AudioInputEventHandlers extends BaseAudioEventHandlers {\n  onMicrophoneData?: (data: ArrayBuffer) => void;\n  onMicrophoneStart?: () => void;\n  onMicrophoneStop?: () => void;\n}\n\nexport class AudioInputManager extends BaseAudioManager {\n  private _isRecording = false;\n  private microphoneManager: MicrophoneManager | null = null;\n\n  constructor(\n    options: AudioInputManagerOptions = {},\n    handlers: AudioInputEventHandlers = {}\n  ) {\n    super(options, handlers);\n  }\n\n  private async initializeMicrophone(): Promise<void> {\n    try {\n      const microphoneHandlers: MicrophoneEventHandlers = {\n        onAudioData: (data) => {\n          (this.handlers as AudioInputEventHandlers).onMicrophoneData?.(data);\n        },\n        onRecordingStart: () => {\n          this._isRecording = true;\n          (this.handlers as AudioInputEventHandlers).onMicrophoneStart?.();\n        },\n        onRecordingStop: () => {\n          this._isRecording = false;\n          (this.handlers as AudioInputEventHandlers).onMicrophoneStop?.();\n        },\n        onError: (error) => this.handleError(error, 'microphone')\n      };\n\n      this.microphoneManager = new MicrophoneManager(\n        { ...(this.options as AudioInputManagerOptions).microphoneConfig, debug: this.debug },\n        microphoneHandlers\n      );\n\n      await this.microphoneManager.initialize();\n      this.log('Microphone manager initialized');\n    } catch (error) {\n      this.handleError(error as Error, 'initializeMicrophone');\n      throw error;\n    }\n  }\n\n  protected async handleAudioData(_data: ArrayBuffer): Promise<void> {\n    // For input manager, we don't handle incoming audio data\n    throw new Error('AudioInputManager does not handle incoming audio data');\n  }\n\n  public async startRecording(): Promise<void> {\n    // Initialize microphone manager on first use if not already initialized\n    if (!this.microphoneManager && (this.options as AudioInputManagerOptions).microphoneConfig) {\n      try {\n        await this.initializeMicrophone();\n      } catch (error) {\n        this.handleError(error as Error, 'startRecording - microphone initialization');\n        throw error;\n      }\n    }\n    \n    if (!this.microphoneManager) {\n      throw new Error('Microphone not configured. Provide microphoneConfig in AudioManagerOptions.');\n    }\n    \n    try {\n      await this.microphoneManager.startRecording();\n      this.log('Recording started');\n    } catch (error) {\n      this.handleError(error as Error, 'startRecording');\n      throw error;\n    }\n  }\n\n  public stopRecording(): void {\n    if (!this.microphoneManager) {\n      this.log('Microphone not initialized');\n      return;\n    }\n    \n    try {\n      this.microphoneManager.stopRecording();\n      this.log('Recording stopped');\n    } catch (error) {\n      this.handleError(error as Error, 'stopRecording');\n    }\n  }\n\n  public async checkMicrophonePermissions() {\n    // Initialize microphone manager on first use if not already initialized\n    if (!this.microphoneManager && (this.options as AudioInputManagerOptions).microphoneConfig) {\n      try {\n        await this.initializeMicrophone();\n      } catch (error) {\n        this.handleError(error as Error, 'checkMicrophonePermissions - microphone initialization');\n        throw error;\n      }\n    }\n    \n    if (!this.microphoneManager) {\n      throw new Error('Microphone not configured. Provide microphoneConfig in AudioManagerOptions.');\n    }\n    return this.microphoneManager.checkPermissions();\n  }\n\n  public getMicrophoneState() {\n    return this.microphoneManager?.getState() || null;\n  }\n\n  public hasMicrophone(): boolean {\n    return this.microphoneManager !== null;\n  }\n\n  /**\n   * Check if currently recording\n   */\n  public isRecording(): boolean {\n    return this._isRecording;\n  }\n\n  public override cleanup(): void {\n    if (this.microphoneManager) {\n      this.microphoneManager.cleanup();\n      this.microphoneManager = null;\n    }\n    super.cleanup();\n  }\n} "]}