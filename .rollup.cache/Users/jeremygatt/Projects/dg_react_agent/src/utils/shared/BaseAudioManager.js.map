{"version":3,"file":"BaseAudioManager.js","sourceRoot":"","sources":["BaseAudioManager.ts"],"names":[],"mappings":"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","sourcesContent":["import { AudioError } from '../../types/common/error';\nimport {\n  createOptimizedAudioContext,\n  validateWebAudioSupport\n} from '../audio/AudioUtils';\n\nexport interface BaseAudioManagerOptions {\n  debug?: boolean;\n  enableVolumeControl?: boolean;\n  initialVolume?: number;\n}\n\nexport interface BaseAudioEventHandlers {\n  onAudioStart?: () => void;\n  onAudioEnd?: () => void;\n  onError?: (error: AudioError) => void;\n}\n\nexport abstract class BaseAudioManager {\n  protected audioContext: AudioContext | null = null;\n  protected gainNode: GainNode | null = null;\n  protected analyzer: AnalyserNode | null = null;\n  protected debug: boolean;\n\n  constructor(\n    protected options: BaseAudioManagerOptions = {},\n    protected handlers: BaseAudioEventHandlers = {}\n  ) {\n    this.debug = options.debug || false;\n  }\n\n  protected log(message: string, data?: any): void {\n    if (this.debug) {\n      console.log(`[AudioManager] ${message}`, data || '');\n    }\n  }\n\n  public async initialize(): Promise<void> {\n    try {\n      // Validate Web Audio support\n      const support = validateWebAudioSupport();\n      if (!support.supported) {\n        throw new Error(`Web Audio API not supported: ${support.missingFeatures.join(', ')}`);\n      }\n\n      // Create audio context\n      this.audioContext = createOptimizedAudioContext();\n\n      // Create gain node if volume control is enabled\n      if (this.options.enableVolumeControl && this.audioContext) {\n        this.gainNode = this.audioContext.createGain();\n        this.gainNode.gain.value = this.options.initialVolume || 1.0;\n        this.gainNode.connect(this.audioContext.destination);\n      }\n\n      // Create analyzer node\n      if (this.audioContext) {\n        this.analyzer = this.audioContext.createAnalyser();\n        this.analyzer.fftSize = 2048;\n      }\n\n      this.log('Audio manager initialized');\n    } catch (error) {\n      this.handleError(error as Error, 'initialize');\n      throw error;\n    }\n  }\n\n  protected handleError(error: Error, context: string): void {\n    const audioError: AudioError = {\n      name: 'AudioError',\n      message: `${context}: ${error.message}`,\n      type: 'audio',\n      code: 'AUDIO_ERROR',\n      details: {\n        context,\n        originalError: error,\n        audioContextState: this.audioContext?.state\n      }\n    };\n\n    if (this.debug) {\n      console.error('Audio Error:', audioError);\n    }\n\n    this.handlers.onError?.(audioError);\n  }\n\n  public cleanup(): void {\n    if (this.audioContext) {\n      this.audioContext.close();\n      this.audioContext = null;\n    }\n    this.gainNode = null;\n    this.analyzer = null;\n  }\n\n  public dispose(): void {\n    this.cleanup();\n  }\n\n  protected abstract handleAudioData(data: ArrayBuffer): Promise<void>;\n} "]}