{"version":3,"file":"useAudioInput.js","sourceRoot":"","sources":["useAudioInput.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AACjE,OAAO,EAAE,iBAAiB,EAAE,MAAM,qCAAqC,CAAC;AACxE,OAAO,EAAE,UAAU,EAAE,MAAM,0BAA0B,CAAC;AACtD,OAAO,EAAE,iBAAiB,EAAE,MAAM,2BAA2B,CAAC;AAsB9D;;;GAGG;AACH,MAAM,UAAU,aAAa,CAAC,OAAkC;IAAhE,iBA8HC;;IA9H6B,wBAAA,EAAA,YAAkC;IAC9D,QAAQ;IACF,IAAA,KAAoC,QAAQ,CAAC,KAAK,CAAC,EAAlD,aAAa,QAAA,EAAE,gBAAgB,QAAmB,CAAC;IACpD,IAAA,KAAoB,QAAQ,CAAoB,IAAI,CAAC,EAApD,KAAK,QAAA,EAAE,QAAQ,QAAqC,CAAC;IAC5D,IAAM,eAAe,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;IAEtC,cAAc;IACd,IAAM,aAAa,GAAG,MAAM,CAA2B,IAAI,CAAC,CAAC;IAE7D,kBAAkB;IAClB,IAAM,GAAG,GAAG,WAAW,CAAC,UAAC,OAAe;QACtC,IAAI,OAAO,CAAC,KAAK,EAAE;YACjB,OAAO,CAAC,GAAG,CAAC,0BAAmB,OAAO,CAAE,CAAC,CAAC;SAC3C;IACH,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;IAEpB,wBAAwB;IACxB,IAAM,UAAU,GAAG,WAAW,CAAC;;;;;;oBAC7B,IAAI,aAAa,IAAI,eAAe,CAAC,OAAO,EAAE;wBAC5C,sBAAO;qBACR;;;;oBAGC,+CAA+C;oBAC/C,aAAa,CAAC,OAAO,GAAG,IAAI,iBAAiB,uBAEtC,iBAAiB,GACjB,OAAO,CAAC,gBAAgB,GAE7B;wBACE,WAAW,EAAE,OAAO,CAAC,gBAAgB;wBACrC,gBAAgB,EAAE;;4BAChB,GAAG,CAAC,iCAAiC,CAAC,CAAC;4BACvC,MAAA,OAAO,CAAC,iBAAiB,uDAAI,CAAC;wBAChC,CAAC;wBACD,eAAe,EAAE;;4BACf,GAAG,CAAC,iCAAiC,CAAC,CAAC;4BACvC,MAAA,OAAO,CAAC,gBAAgB,uDAAI,CAAC;wBAC/B,CAAC;wBACD,OAAO,EAAE,UAAC,KAAK;;4BACb,IAAM,UAAU,GAAG,KAAK,YAAY,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,UAAU,CAAC,kBAAkB,EAAE;gCAC1F,aAAa,EAAE,KAAK;6BACrB,CAAC,CAAC;4BACH,QAAQ,CAAC,UAAU,CAAC,CAAC;4BACrB,MAAA,OAAO,CAAC,OAAO,wDAAG,UAAU,CAAC,CAAC;wBAChC,CAAC;qBACF,CACF,CAAC;oBAEF,qBAAqB;oBACrB,qBAAM,aAAa,CAAC,OAAO,CAAC,UAAU,EAAE,EAAA;;oBADxC,qBAAqB;oBACrB,SAAwC,CAAC;oBACzC,gBAAgB,CAAC,IAAI,CAAC,CAAC;oBACvB,GAAG,CAAC,0BAA0B,CAAC,CAAC;;;;oBAE1B,UAAU,GAAG,OAAK,YAAY,UAAU,CAAC,CAAC,CAAC,OAAK,CAAC,CAAC,CAAC,IAAI,UAAU,CAAC,iCAAiC,EAAE;wBACzG,aAAa,EAAE,OAAK,YAAY,KAAK,CAAC,CAAC,CAAC,OAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC;qBAC3E,CAAC,CAAC;oBACH,QAAQ,CAAC,UAAU,CAAC,CAAC;oBACrB,MAAA,OAAO,CAAC,OAAO,wDAAG,UAAU,CAAC,CAAC;oBAC9B,MAAM,UAAU,CAAC;;;;SAEpB,EAAE,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,gBAAgB,EAAE,OAAO,CAAC,gBAAgB,EAAE,OAAO,CAAC,iBAAiB,EAAE,OAAO,CAAC,gBAAgB,EAAE,OAAO,CAAC,OAAO,EAAE,GAAG,EAAE,aAAa,CAAC,CAAC,CAAC;IAElK,6BAA6B;IAC7B,SAAS,CAAC;QACR,IAAI,OAAO,CAAC,cAAc,EAAE;YAC1B,UAAU,EAAE,CAAC,KAAK,CAAC,cAAO,CAAC,CAAC,CAAC,CAAC,2CAA2C;SAC1E;QAED,OAAO;YACL,eAAe,CAAC,OAAO,GAAG,IAAI,CAAC;YAC/B,IAAI,aAAa,CAAC,OAAO,EAAE;gBACzB,aAAa,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;gBAChC,aAAa,CAAC,OAAO,GAAG,IAAI,CAAC;aAC9B;YACD,gBAAgB,CAAC,KAAK,CAAC,CAAC;YACxB,QAAQ,CAAC,IAAI,CAAC,CAAC;QACjB,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,OAAO,CAAC,cAAc,EAAE,UAAU,CAAC,CAAC,CAAC;IAEzC,kBAAkB;IAClB,IAAM,cAAc,GAAG,WAAW,CAAC;;;;;;;yBAG3B,CAAC,aAAa,EAAd,wBAAc;oBAChB,qBAAM,UAAU,EAAE,EAAA;;oBAAlB,SAAkB,CAAC;;;oBAGrB,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE;wBAC1B,MAAM,IAAI,UAAU,CAAC,4BAA4B,CAAC,CAAC;qBACpD;oBAED,qBAAM,aAAa,CAAC,OAAO,CAAC,cAAc,EAAE,EAAA;;oBAA5C,SAA4C,CAAC;oBAC7C,GAAG,CAAC,qBAAqB,CAAC,CAAC;;;;oBAErB,UAAU,GAAG,OAAK,YAAY,UAAU,CAAC,CAAC,CAAC,OAAK,CAAC,CAAC,CAAC,IAAI,UAAU,CAAC,2BAA2B,EAAE;wBACnG,aAAa,EAAE,OAAK,YAAY,KAAK,CAAC,CAAC,CAAC,OAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC;qBAC3E,CAAC,CAAC;oBACH,QAAQ,CAAC,UAAU,CAAC,CAAC;oBACrB,MAAA,OAAO,CAAC,OAAO,wDAAG,UAAU,CAAC,CAAC;oBAC9B,MAAM,UAAU,CAAC;;;;SAEpB,EAAE,CAAC,UAAU,EAAE,aAAa,EAAE,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;IAEtD,iBAAiB;IACjB,IAAM,aAAa,GAAG,WAAW,CAAC;;QAChC,IAAI;YACF,MAAA,aAAa,CAAC,OAAO,0CAAE,aAAa,EAAE,CAAC;YACvC,GAAG,CAAC,qBAAqB,CAAC,CAAC;SAC5B;QAAC,OAAO,KAAK,EAAE;YACd,IAAM,UAAU,GAAG,KAAK,YAAY,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,UAAU,CAAC,0BAA0B,EAAE;gBAClG,aAAa,EAAE,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC;aAC3E,CAAC,CAAC;YACH,QAAQ,CAAC,UAAU,CAAC,CAAC;YACrB,MAAA,OAAO,CAAC,OAAO,wDAAG,UAAU,CAAC,CAAC;SAC/B;IACH,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;IAE3B,OAAO;QACL,UAAU,YAAA;QACV,cAAc,gBAAA;QACd,aAAa,eAAA;QACb,WAAW,EAAE,CAAA,MAAA,aAAa,CAAC,OAAO,0CAAE,WAAW,EAAE,KAAI,KAAK;QAC1D,aAAa,eAAA;QACb,KAAK,OAAA;KACN,CAAC;AACJ,CAAC","sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\nimport { MicrophoneManager } from '../../utils/audio/MicrophoneManager';\nimport { AudioError } from '../../types/common/error';\nimport { MICROPHONE_CONFIG } from '../../utils/shared/config';\nimport type { MicrophoneConfig } from '../../types/common/microphone';\n\ninterface UseAudioInputOptions {\n  debug?: boolean;\n  microphoneConfig?: Partial<MicrophoneConfig>;\n  autoInitialize?: boolean; // New option to control automatic initialization\n  onMicrophoneData?: (data: ArrayBuffer) => void;\n  onMicrophoneStart?: () => void;\n  onMicrophoneStop?: () => void;\n  onError?: (error: AudioError) => void;\n}\n\ninterface UseAudioInputReturn {\n  initialize: () => Promise<void>; // New method for manual initialization\n  startRecording: () => Promise<void>;\n  stopRecording: () => void;\n  isRecording: boolean;\n  isInitialized: boolean;\n  error: AudioError | null;\n}\n\n/**\n * Hook for managing microphone input.\n * Handles initialization, recording, and cleanup of microphone resources.\n */\nexport function useAudioInput(options: UseAudioInputOptions = {}): UseAudioInputReturn {\n  // State\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [error, setError] = useState<AudioError | null>(null);\n  const isCleaningUpRef = useRef(false);\n\n  // Manager ref\n  const microphoneRef = useRef<MicrophoneManager | null>(null);\n\n  // Logging utility\n  const log = useCallback((message: string) => {\n    if (options.debug) {\n      console.log(`[useAudioInput] ${message}`);\n    }\n  }, [options.debug]);\n\n  // Initialize microphone\n  const initialize = useCallback(async () => {\n    if (isInitialized || isCleaningUpRef.current) {\n      return;\n    }\n\n    try {\n      // Create microphone manager with merged config\n      microphoneRef.current = new MicrophoneManager(\n        {\n          ...MICROPHONE_CONFIG,\n          ...options.microphoneConfig\n        },\n        {\n          onAudioData: options.onMicrophoneData,\n          onRecordingStart: () => {\n            log('ðŸŽ¤ Microphone recording started');\n            options.onMicrophoneStart?.();\n          },\n          onRecordingStop: () => {\n            log('ðŸŽ¤ Microphone recording stopped');\n            options.onMicrophoneStop?.();\n          },\n          onError: (error) => {\n            const audioError = error instanceof AudioError ? error : new AudioError('Microphone error', {\n              originalError: error\n            });\n            setError(audioError);\n            options.onError?.(audioError);\n          }\n        }\n      );\n\n      // Initialize manager\n      await microphoneRef.current.initialize();\n      setIsInitialized(true);\n      log('âœ… Microphone initialized');\n    } catch (error) {\n      const audioError = error instanceof AudioError ? error : new AudioError('Failed to initialize microphone', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(audioError);\n      options.onError?.(audioError);\n      throw audioError;\n    }\n  }, [options.debug, options.microphoneConfig, options.onMicrophoneData, options.onMicrophoneStart, options.onMicrophoneStop, options.onError, log, isInitialized]);\n\n  // Auto-initialize if enabled\n  useEffect(() => {\n    if (options.autoInitialize) {\n      initialize().catch(() => {}); // Errors are already handled in initialize\n    }\n\n    return () => {\n      isCleaningUpRef.current = true;\n      if (microphoneRef.current) {\n        microphoneRef.current.cleanup();\n        microphoneRef.current = null;\n      }\n      setIsInitialized(false);\n      setError(null);\n    };\n  }, [options.autoInitialize, initialize]);\n\n  // Start recording\n  const startRecording = useCallback(async () => {\n    try {\n      // Auto-initialize if not initialized\n      if (!isInitialized) {\n        await initialize();\n      }\n\n      if (!microphoneRef.current) {\n        throw new AudioError('Microphone not initialized');\n      }\n\n      await microphoneRef.current.startRecording();\n      log('âœ… Recording started');\n    } catch (error) {\n      const audioError = error instanceof AudioError ? error : new AudioError('Failed to start recording', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(audioError);\n      options.onError?.(audioError);\n      throw audioError;\n    }\n  }, [initialize, isInitialized, options.onError, log]);\n\n  // Stop recording\n  const stopRecording = useCallback(() => {\n    try {\n      microphoneRef.current?.stopRecording();\n      log('âœ… Recording stopped');\n    } catch (error) {\n      const audioError = error instanceof AudioError ? error : new AudioError('Failed to stop recording', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(audioError);\n      options.onError?.(audioError);\n    }\n  }, [options.onError, log]);\n\n  return {\n    initialize,\n    startRecording,\n    stopRecording,\n    isRecording: microphoneRef.current?.isRecording() || false,\n    isInitialized,\n    error\n  };\n} "]}