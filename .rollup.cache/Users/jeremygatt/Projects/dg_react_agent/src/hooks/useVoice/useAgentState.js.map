{"version":3,"file":"useAgentState.js","sourceRoot":"","sources":["useAgentState.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useState } from 'react';\nimport { AgentState, UpdateInstructionsPayload } from '../../types/voice';\nimport { VoiceWebSocketManager } from '../../utils/websocket/VoiceWebSocketManager';\nimport { AudioOutputManager } from '../../utils/audio/AudioOutputManager';\nimport { MODEL_CONFIG } from '../../utils/shared/config';\n\ninterface UseAgentStateOptions {\n  onAgentStateChange?: (state: AgentState) => void;\n  debug?: boolean;\n}\n\ninterface UseAgentStateReturn {\n  agentState: AgentState;\n  isWaitingForUserVoiceAfterSleep: boolean;\n  clearAudio: () => void;\n  interruptAgent: () => void;\n  sleep: () => void;\n  wake: () => void;\n  toggleSleep: () => void;\n  updateAgentInstructions: (payload: UpdateInstructionsPayload) => void;\n  injectAgentMessage: (text: string) => void;\n}\n\nexport function useAgentState(\n  managers: {\n    agent: React.RefObject<VoiceWebSocketManager>;\n    audio: React.RefObject<AudioOutputManager>;\n  },\n  options: UseAgentStateOptions = {}\n): UseAgentStateReturn {\n  const [agentState, setAgentState] = useState<AgentState>('idle');\n  const [isWaitingForUserVoiceAfterSleep, setIsWaitingForUserVoiceAfterSleep] = useState(false);\n\n  const log = useCallback((message: string) => {\n    if (options.debug) {\n      console.log(`[AgentState] ${message}`);\n    }\n  }, [options.debug]);\n\n  // Clear audio playback\n  const clearAudio = useCallback((): void => {\n    log('ðŸ“¢ clearAudio helper called');\n\n    if (!managers.audio.current) {\n      log('âŒ Cannot clear audio: audio manager is null');\n      return;\n    }\n\n    try {\n      log('ðŸ”´ Calling audioManager.clearAudioQueue()');\n      managers.audio.current.clearAudioQueue();\n    } catch (err) {\n      log(`âŒ Error in clearAudio: ${err instanceof Error ? err.message : 'Unknown error'}`);\n    }\n\n    log('ðŸ“¢ clearAudio helper completed');\n  }, [managers.audio, log]);\n\n  // Interrupt the agent\n  const interruptAgent = useCallback((): void => {\n    log('ðŸ”´ interruptAgent method called');\n\n    if (!managers.agent.current) {\n      log('Cannot interrupt agent: agent not configured');\n      return;\n    }\n\n    clearAudio();\n    log('ðŸ”´ Setting agent state to idle');\n    setAgentState('idle');\n    options.onAgentStateChange?.('idle');\n    log('ðŸ”´ interruptAgent method completed');\n  }, [clearAudio, log, options.onAgentStateChange]);\n\n  // Put agent to sleep\n  const sleep = useCallback((): void => {\n    if (!managers.agent.current) {\n      log('Cannot put agent to sleep: agent not configured');\n      return;\n    }\n\n    log('ðŸ’¤ Putting agent to sleep...');\n    setIsWaitingForUserVoiceAfterSleep(true);\n    clearAudio();\n    setAgentState('entering_sleep');\n    options.onAgentStateChange?.('entering_sleep');\n    log('âœ… Agent entering sleep mode');\n  }, [clearAudio, log, options.onAgentStateChange]);\n\n  // Wake agent from sleep\n  const wake = useCallback((): void => {\n    if (!managers.agent.current) {\n      log('Cannot wake agent: agent not configured');\n      return;\n    }\n\n    if (agentState !== 'sleeping') {\n      log(`Cannot wake agent: Current state is ${agentState}, not 'sleeping'`);\n      return;\n    }\n\n    log('ðŸŒ… Waking agent...');\n    setIsWaitingForUserVoiceAfterSleep(false);\n    setAgentState('listening');\n    options.onAgentStateChange?.('listening');\n    log('âœ… Agent awake and listening');\n  }, [agentState, log, options.onAgentStateChange]);\n\n  // Toggle between sleep and wake states\n  const toggleSleep = useCallback((): void => {\n    if (!managers.agent.current) {\n      log('Cannot toggle sleep state: agent not configured');\n      return;\n    }\n\n    log(`ðŸ”„ Toggling sleep state. Current state: ${agentState}`);\n    if (agentState === 'sleeping') {\n      wake();\n    } else if (agentState !== 'entering_sleep') {\n      sleep();\n    } else {\n      log('Already entering sleep mode, ignoring toggle');\n    }\n  }, [agentState, wake, sleep, log]);\n\n  // Update agent instructions\n  const updateAgentInstructions = useCallback((payload: UpdateInstructionsPayload): void => {\n    if (!managers.agent.current) {\n      log('Cannot update instructions: Agent not configured');\n      return;\n    }\n\n    log('ðŸ”„ Updating agent instructions...');\n    managers.agent.current.sendJSON({\n      type: 'Configure',\n      listenModel: MODEL_CONFIG.agent.listen,\n      thinkModel: MODEL_CONFIG.agent.think,\n      voice: MODEL_CONFIG.agent.speak,\n      instructions: payload.instructions,\n      context: payload.context\n    });\n    log('âœ… Agent instructions updated');\n  }, [log]);\n\n  // Inject a message directly to the agent\n  const injectAgentMessage = useCallback((text: string): void => {\n    if (!managers.agent.current) {\n      log('Cannot inject message: Agent not configured');\n      return;\n    }\n\n    log(`ðŸ’¬ Injecting agent message: ${text}`);\n    managers.agent.current.sendJSON({\n      type: 'InjectAgentMessage',\n      content: text\n    });\n    log('âœ… Message injected');\n  }, [log]);\n\n  return {\n    agentState,\n    isWaitingForUserVoiceAfterSleep,\n    clearAudio,\n    interruptAgent,\n    sleep,\n    wake,\n    toggleSleep,\n    updateAgentInstructions,\n    injectAgentMessage\n  };\n} "]}