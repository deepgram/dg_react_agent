{"version":3,"file":"useVoiceInteraction.js","sourceRoot":"","sources":["useVoiceInteraction.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\nimport { useAudioInput } from '../useAudio/useAudioInput';\nimport { useWebSocketConnection } from '../useWebSocket/useWebSocketConnection';\nimport { VoiceWebSocketManager } from '../../utils/websocket/VoiceWebSocketManager';\nimport { AudioInputManager } from '../../utils/audio/AudioInputManager';\nimport { AudioOutputManager } from '../../utils/audio/AudioOutputManager';\nimport { AgentState, AgentOptions, TranscriptResponse, LLMResponse, UserMessageResponse, UpdateInstructionsPayload } from '../../types/voice';\nimport { VoiceError } from '../../types/voice/error';\nimport { AudioError } from '../../types/common/error';\nimport { AUDIO_CONFIG, MODEL_CONFIG } from '../../utils/shared/config';\n\ninterface UseVoiceInteractionOptions {\n  apiKey: string;\n  transcriptionOptions?: Record<string, any>;\n  agentOptions?: AgentOptions;\n  microphoneConfig?: Record<string, any>;\n  debug?: boolean;\n  onReady?: (isReady: boolean) => void;\n  onTranscriptUpdate?: (transcript: TranscriptResponse) => void;\n  onAgentUtterance?: (response: LLMResponse) => void;\n  onUserMessage?: (message: UserMessageResponse) => void;\n  onAgentStateChange?: (state: AgentState) => void;\n  onError?: (error: VoiceError) => void;\n}\n\ninterface UseVoiceInteractionReturn {\n  // Core functionality\n  initialize: () => Promise<void>;\n  start: () => Promise<void>;\n  stop: () => Promise<void>;\n  \n  // Recording control\n  startRecording: () => Promise<void>;\n  stopRecording: () => void;\n  \n  // Agent control\n  updateAgentInstructions: (payload: UpdateInstructionsPayload) => void;\n  interruptAgent: () => void;\n  sleep: () => void;\n  wake: () => void;\n  toggleSleep: () => void;\n  injectAgentMessage: (text: string) => void;\n  \n  // State queries\n  getMicrophoneState: () => any;\n  getConnectionState: () => { transcription: boolean; agent: boolean };\n  getAgentState: () => AgentState;\n  \n  // State\n  isReady: boolean;\n  isRecording: boolean;\n  agentState: AgentState;\n  error: VoiceError | null;\n}\n\nexport function useVoiceInteraction(options: UseVoiceInteractionOptions): UseVoiceInteractionReturn {\n  // State\n  const [isReady, setIsReady] = useState(false);\n  const [error, setError] = useState<VoiceError | null>(null);\n  const [agentState, setAgentState] = useState<AgentState>('idle');\n  const isCleaningUpRef = useRef(false);\n  const userSpeakingRef = useRef(false);\n  const isWaitingForUserVoiceAfterSleep = useRef(false);\n  const isInitializedRef = useRef(false);\n  const optionsRef = useRef(options);\n\n  // Update options ref when they change\n  useEffect(() => {\n    optionsRef.current = options;\n  }, [options]);\n\n  // Logging utility\n  const log = useCallback((message: string) => {\n    if (optionsRef.current.debug) {\n      console.log(`[VoiceInteraction] ${message}`);\n    }\n  }, []); // No dependencies needed since we use ref\n\n  // Managers\n  const transcriptionManager = useRef<VoiceWebSocketManager | null>(null);\n  const agentManager = useRef<VoiceWebSocketManager | null>(null);\n  const audioInputRef = useRef<AudioInputManager | null>(null);\n  const audioOutputRef = useRef<AudioOutputManager | null>(null);\n\n  // Cleanup utility\n  const cleanupManagers = useCallback(() => {\n    if (!isCleaningUpRef.current) {\n    isCleaningUpRef.current = true;\n    log('ðŸ§¹ Cleaning up voice interaction system...');\n    \n    if (transcriptionManager.current) {\n      transcriptionManager.current.cleanup();\n      transcriptionManager.current = null;\n    }\n    if (agentManager.current) {\n      agentManager.current.cleanup();\n      agentManager.current = null;\n    }\n    if (audioInputRef.current) {\n      audioInputRef.current.cleanup();\n      audioInputRef.current = null;\n    }\n    if (audioOutputRef.current) {\n      audioOutputRef.current.cleanup();\n      audioOutputRef.current = null;\n    }\n\n      isCleaningUpRef.current = false;\n      isInitializedRef.current = false;\n    setIsReady(false);\n    log('âœ… Voice interaction system cleaned up');\n    }\n  }, []); // No dependencies needed since we use refs\n\n  // Initialize voice interaction system\n  useEffect(() => {\n    if (!optionsRef.current.apiKey || isCleaningUpRef.current) return;\n\n    const initialize = async () => {\n      try {\n        log('ðŸš€ Initializing voice interaction system...');\n\n        // Create WebSocket managers\n        transcriptionManager.current = new VoiceWebSocketManager({\n          type: 'transcription',\n          apiKey: optionsRef.current.apiKey,\n          model: optionsRef.current.transcriptionOptions?.model || MODEL_CONFIG.transcription.default,\n          encoding: AUDIO_CONFIG.encoding,\n          sampleRate: AUDIO_CONFIG.sampleRate,\n          debug: optionsRef.current.debug\n        });\n\n        agentManager.current = new VoiceWebSocketManager({\n          type: 'agent',\n          apiKey: optionsRef.current.apiKey,\n          debug: optionsRef.current.debug\n        });\n\n        setIsReady(true);\n        log('âœ… Voice interaction system ready');\n      } catch (error) {\n        const voiceError = error instanceof VoiceError ? error : new VoiceError('initialization_failed', {\n          originalError: error instanceof Error ? error : new Error('Unknown error')\n        });\n        setError(voiceError);\n        optionsRef.current.onError?.(voiceError);\n        throw voiceError;\n      }\n    };\n\n    initialize().catch((error) => {\n      log(`âŒ Auto-initialization failed: ${error.message}`);\n    });\n\n    return () => {\n      isCleaningUpRef.current = true;\n      transcriptionManager.current?.cleanup();\n      agentManager.current?.cleanup();\n      transcriptionManager.current = null;\n      agentManager.current = null;\n    };\n  }, []);\n\n  // Use base hooks\n  const {\n    startRecording: startAudioInput,\n    stopRecording: stopAudioInput,\n    isRecording,\n    error: audioError\n  } = useAudioInput({\n    debug: optionsRef.current.debug,\n    microphoneConfig: optionsRef.current.microphoneConfig,\n    onMicrophoneData: (data: ArrayBuffer) => {\n      if (transcriptionManager.current?.isConnected()) {\n        transcriptionManager.current.sendBinary(data);\n      }\n    },\n    onError: (error: AudioError) => {\n      setError(new VoiceError('audio_error', { originalError: error }));\n      optionsRef.current.onError?.(new VoiceError('audio_error', { originalError: error }));\n    }\n  });\n\n  const {\n    connect: connectTranscription,\n    disconnect: disconnectTranscription,\n    error: transcriptionError\n  } = useWebSocketConnection(transcriptionManager.current, {\n    debug: optionsRef.current.debug,\n    onError: (error: Error) => {\n      setError(new VoiceError('transcription_error', { originalError: error }));\n      optionsRef.current.onError?.(new VoiceError('transcription_error', { originalError: error }));\n    }\n  });\n\n  const {\n    connect: connectAgent,\n    disconnect: disconnectAgent,\n    sendMessage: sendAgentMessage,\n    error: agentError\n  } = useWebSocketConnection(agentManager.current, {\n    debug: optionsRef.current.debug,\n    onError: (error: Error) => {\n      setError(new VoiceError('agent_error', { originalError: error }));\n      optionsRef.current.onError?.(new VoiceError('agent_error', { originalError: error }));\n    }\n  });\n\n  // Handle errors from base hooks\n  useEffect(() => {\n    if (audioError) {\n      setError(new VoiceError('audio_error', { originalError: audioError }));\n      optionsRef.current.onError?.(new VoiceError('audio_error', { originalError: audioError }));\n    } else if (transcriptionError) {\n      setError(new VoiceError('transcription_error', { originalError: transcriptionError }));\n      optionsRef.current.onError?.(new VoiceError('transcription_error', { originalError: transcriptionError }));\n    } else if (agentError) {\n      setError(new VoiceError('agent_error', { originalError: agentError }));\n      optionsRef.current.onError?.(new VoiceError('agent_error', { originalError: agentError }));\n    }\n  }, [audioError, transcriptionError, agentError]);\n\n  // Start interaction\n  const start = useCallback(async () => {\n    try {\n      if (!isReady) {\n        throw new VoiceError('invalid_state', {\n          context: 'Voice interaction system is not ready'\n        });\n      }\n\n      const transcription = transcriptionManager.current;\n      const agent = agentManager.current;\n\n      if (!transcription || !agent) {\n        throw new VoiceError('invalid_state', {\n          context: 'WebSocket managers not initialized'\n        });\n      }\n\n      // Connect WebSocket managers\n      const connectTranscription = new Promise<void>((resolve, reject) => {\n        const removeListener = transcription.addEventListener((event) => {\n          if (event.type === 'state' && event.state === 'connected') {\n            removeListener();\n            resolve();\n          } else if (event.type === 'error') {\n            removeListener();\n            reject(event.error);\n          }\n        });\n\n        transcription.connect();\n      });\n\n      const connectAgent = new Promise<void>((resolve, reject) => {\n        const removeListener = agent.addEventListener((event) => {\n          if (event.type === 'message' && event.data.type === 'Welcome') {\n            // Send initial agent settings\n            if (optionsRef.current.agentOptions) {\n              agent.sendJSON({\n                type: 'Settings',\n                audio: {\n                  input: {\n                    encoding: AUDIO_CONFIG.encoding,\n                    sample_rate: AUDIO_CONFIG.sampleRate,\n                  },\n                  output: {\n                    encoding: AUDIO_CONFIG.encoding,\n                    sample_rate: AUDIO_CONFIG.sampleRate,\n                  },\n                },\n                agent: {\n                  language: optionsRef.current.agentOptions.language || 'en',\n                  listen: {\n                    provider: {\n                      type: 'deepgram',\n                      model: optionsRef.current.agentOptions.listenModel || MODEL_CONFIG.agent.listen,\n                    },\n                  },\n                  think: {\n                    provider: {\n                      type: optionsRef.current.agentOptions.thinkProviderType || 'open_ai',\n                      model: optionsRef.current.agentOptions.thinkModel || MODEL_CONFIG.agent.think,\n                    },\n                    prompt: optionsRef.current.agentOptions.instructions || 'You are a helpful voice assistant.',\n                    ...(optionsRef.current.agentOptions.thinkEndpointUrl && optionsRef.current.agentOptions.thinkApiKey\n                      ? {\n                          endpoint: {\n                            url: optionsRef.current.agentOptions.thinkEndpointUrl,\n                            headers: {\n                              authorization: `bearer ${optionsRef.current.agentOptions.thinkApiKey}`,\n                            },\n                          },\n                        }\n                      : {}),\n                  },\n                  speak: {\n                    provider: {\n                      type: 'deepgram',\n                      model: optionsRef.current.agentOptions.voice || MODEL_CONFIG.agent.speak,\n                    },\n                  },\n                  greeting: optionsRef.current.agentOptions.greeting,\n                },\n              });\n            }\n            removeListener();\n            resolve();\n          } else if (event.type === 'error') {\n            removeListener();\n            reject(event.error);\n          }\n        });\n\n        agent.connect();\n      });\n\n      // Wait for both connections and settings to be applied\n      await Promise.all([connectTranscription, connectAgent]);\n\n      // Start recording\n      await startAudioInput();\n\n      log('âœ… Voice interaction started');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('start_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n      throw voiceError;\n    }\n  }, [isReady, log, startAudioInput]);\n\n  // Stop interaction\n  const stop = useCallback(async () => {\n    try {\n      // Stop recording first\n      stopAudioInput();\n\n      // Then disconnect WebSockets\n      transcriptionManager.current?.disconnect();\n      agentManager.current?.disconnect();\n\n      log('âœ… Voice interaction stopped');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('stop_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n      throw voiceError;\n    }\n  }, [stopAudioInput, log]);\n\n  // Agent control methods\n  const updateAgentInstructions = useCallback((payload: UpdateInstructionsPayload) => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      sendAgentMessage({\n        type: 'UpdateInstructions',\n        instructions: payload.instructions,\n        context: payload.context\n      });\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('update_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage]);\n\n  const interruptAgent = useCallback(() => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      sendAgentMessage({ type: 'Interrupt' });\n      setAgentState('idle');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('interrupt_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage]);\n\n  const sleep = useCallback(() => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      sendAgentMessage({ type: 'Sleep' });\n      setAgentState('sleeping');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('sleep_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage]);\n\n  const wake = useCallback(() => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      if (agentState !== 'sleeping') {\n        throw new VoiceError('agent_not_sleeping');\n      }\n      sendAgentMessage({ type: 'Wake' });\n      setAgentState('listening');\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('wake_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage, agentState]);\n\n  const toggleSleep = useCallback(() => {\n    if (agentState === 'sleeping') {\n      wake();\n    } else {\n      sleep();\n    }\n  }, [agentState, wake, sleep]);\n\n  const injectAgentMessage = useCallback((text: string) => {\n    try {\n      if (!agentManager.current) {\n        throw new VoiceError('agent_not_initialized');\n      }\n      sendAgentMessage({\n        type: 'InjectMessage',\n        text\n      });\n    } catch (error) {\n      const voiceError = error instanceof VoiceError ? error : new VoiceError('inject_failed', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(voiceError);\n      optionsRef.current.onError?.(voiceError);\n    }\n  }, [sendAgentMessage]);\n\n  return {\n    initialize: () => Promise.resolve(), // No-op since initialization is automatic\n    start,\n    stop,\n    startRecording: startAudioInput,\n    stopRecording: stopAudioInput,\n    updateAgentInstructions,\n    interruptAgent,\n    sleep,\n    wake,\n    toggleSleep,\n    injectAgentMessage,\n    getMicrophoneState: () => audioInputRef.current?.getMicrophoneState() || null,\n    getConnectionState: () => ({\n      transcription: transcriptionManager.current?.isConnected() || false,\n      agent: agentManager.current?.isConnected() || false\n    }),\n    getAgentState: () => agentState,\n    isReady,\n    isRecording: audioInputRef.current?.isRecording() || false,\n    agentState,\n    error\n  };\n} "]}