{"version":3,"file":"useWebSocketConnection.js","sourceRoot":"","sources":["useWebSocketConnection.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\nimport { BaseWebSocketManager } from '../../utils/shared/BaseWebSocketManager';\nimport { ConnectionState } from '../../types/common/connection';\nimport { ConnectionError } from '../../types/common/error';\n\ninterface UseWebSocketConnectionOptions {\n  debug?: boolean;\n  onConnectionStateChange?: (state: ConnectionState) => void;\n  onError?: (error: ConnectionError) => void;\n}\n\ninterface UseWebSocketConnectionReturn {\n  connect: () => void;\n  disconnect: () => void;\n  sendMessage: (message: any) => void;\n  sendBinary: (data: ArrayBuffer) => void;\n  isConnected: boolean;\n  connectionState: ConnectionState;\n  error: ConnectionError | null;\n}\n\n/**\n * Base hook for WebSocket connection management.\n * Handles connection lifecycle, message sending, and error handling.\n */\nexport function useWebSocketConnection(\n  manager: BaseWebSocketManager | null,\n  options: UseWebSocketConnectionOptions = {}\n): UseWebSocketConnectionReturn {\n  // State\n  const [connectionState, setConnectionState] = useState<ConnectionState>('disconnected');\n  const [error, setError] = useState<ConnectionError | null>(null);\n  const isCleaningUpRef = useRef(false);\n\n  // Logging utility\n  const log = useCallback((message: string) => {\n    if (options.debug) {\n      console.log(`[useWebSocketConnection] ${message}`);\n    }\n  }, [options.debug]);\n\n  // Handle connection state changes\n  useEffect(() => {\n    if (!manager || isCleaningUpRef.current) return;\n\n    const handleStateChange = (state: ConnectionState) => {\n      setConnectionState(state);\n      options.onConnectionStateChange?.(state);\n      log(`ðŸ”„ Connection state: ${state}`);\n    };\n\n    const handleError = (error: ConnectionError) => {\n      setError(error);\n      options.onError?.(error);\n      log(`âŒ Connection error: ${error.message}`);\n    };\n\n    const removeListener = manager.addEventListener((event) => {\n      if (event.type === 'state' && event.state) {\n        handleStateChange(event.state);\n      } else if (event.type === 'error' && event.error) {\n        handleError(event.error);\n      }\n    });\n\n    return () => {\n      isCleaningUpRef.current = true;\n      removeListener();\n    };\n  }, [manager, options.onConnectionStateChange, options.onError, log]);\n\n  // Connect\n  const connect = useCallback(() => {\n    try {\n      if (!manager) {\n        throw new ConnectionError('Cannot connect - WebSocket manager not initialized');\n      }\n      manager.connect();\n    } catch (error) {\n      const connectionError = error instanceof ConnectionError ? error : new ConnectionError('Failed to connect', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(connectionError);\n      options.onError?.(connectionError);\n    }\n  }, [manager, options.onError]);\n\n  // Disconnect\n  const disconnect = useCallback(() => {\n    try {\n      manager?.disconnect();\n    } catch (error) {\n      const connectionError = error instanceof ConnectionError ? error : new ConnectionError('Failed to disconnect', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(connectionError);\n      options.onError?.(connectionError);\n    }\n  }, [manager, options.onError]);\n\n  // Send message\n  const sendMessage = useCallback((message: any) => {\n    try {\n      if (!manager) {\n        throw new ConnectionError('Cannot send message - WebSocket manager not initialized');\n      }\n      if (connectionState !== 'connected') {\n        throw new ConnectionError('Cannot send message - WebSocket not connected');\n      }\n      manager.sendMessage(message);\n    } catch (error) {\n      const connectionError = error instanceof ConnectionError ? error : new ConnectionError('Failed to send message', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(connectionError);\n      options.onError?.(connectionError);\n    }\n  }, [manager, connectionState, options.onError]);\n\n  // Send binary data\n  const sendBinary = useCallback((data: ArrayBuffer) => {\n    try {\n      if (!manager) {\n        throw new ConnectionError('Cannot send binary data - WebSocket manager not initialized');\n      }\n      if (connectionState !== 'connected') {\n        throw new ConnectionError('Cannot send binary data - WebSocket not connected');\n      }\n      manager.sendBinary(data);\n    } catch (error) {\n      const connectionError = error instanceof ConnectionError ? error : new ConnectionError('Failed to send binary data', {\n        originalError: error instanceof Error ? error : new Error('Unknown error')\n      });\n      setError(connectionError);\n      options.onError?.(connectionError);\n    }\n  }, [manager, connectionState, options.onError]);\n\n  return {\n    connect,\n    disconnect,\n    sendMessage,\n    sendBinary,\n    isConnected: connectionState === 'connected',\n    connectionState,\n    error\n  };\n} "]}